<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>INLabTube</title>
    <link rel="stylesheet" href="/style.css"/>
    <link rel="icon" href="/favicon.ico"/>

    <script src="https://cdn.jsdelivr.net/npm/ipfs/dist/index.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/0.12.4/hls.js"></script>
    <script src="/test.min.js"></script>
    <script>
      function lobbyButton() {
        window.location.href = '/';
      }
    </script>
  </head>
  <body>
    <div class="menubar">
      <div>
        <div class="lobby" onclick="lobbyButton()">
          <div><img src="/ipfs.jpeg"></div>
          <div>INLabTube</div>
        </div>
      </div>
    </div>
    <script>
      let state = window.location.search;
      let splitState = state.split('=');
      let CID = splitState[1];

      initIPFS()
      
      async function initIPFS() {
        const repoPath = 'ipfs-' + Math.random();
        const node = await Ipfs.create({repo: repoPath});
        
        Hls.DefaultConfig.loader = HlsjsIpfsLoader;
        Hls.DefaultConfig.debug = false;
        if (Hls.isSupported()) {
          const video = document.getElementById('video');
          const status = document.getElementById('status');
          const hls = new Hls();
          hls.config.ipfs = node;
          hls.config.ipfsHash = CID;
          hls.loadSource('master.m3u8');
          hls.attachMedia(video);
          hls.on(Hls.Events.MANIFEST_PARSED, () => {
            const message = document.createTextNode(`${CID}`)
            status.appendChild(message)
            video.play();
          });
        } else {
          const status = document.getElementById('status');
          const message = document.createTextNode('Sorry, your browser does not support HLS')
          status.appendChild(message)
        }
      }

      async function initHLS() {
        
      }
    </script>

    <video id="video" controls autoplay></video>
    <div id="status"></div>
  </body>
</html>
