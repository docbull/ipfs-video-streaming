'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var parser = require('./parser.js');
var commandAlias = require('./command-alias.js');
var errCode = require('err-code');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var errCode__default = /*#__PURE__*/_interopDefaultLegacy(errCode);

function cli(command, ctxMiddleware) {
  command = commandAlias(command);
  return new Promise((resolve, reject) => {
    try {
      parser.middleware(ctxMiddleware).onFinishCommand(data => {
        resolve(data);
      }).fail((msg, err, yargs) => {
        if (msg) {
          if (msg.includes('Unknown argument') || msg.includes('Please specify a command')) {
            yargs = parser;
          }
          return reject(errCode__default["default"](new Error(msg), 'ERR_YARGS', { yargs }));
        }
        reject(err);
      }).parse(command);
    } catch (err) {
      return reject(err);
    }
  });
}

exports.cli = cli;
