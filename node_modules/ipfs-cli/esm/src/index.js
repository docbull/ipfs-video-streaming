import parser from './parser.js';
import commandAlias from './command-alias.js';
import errCode from 'err-code';
export function cli(command, ctxMiddleware) {
  command = commandAlias(command);
  return new Promise((resolve, reject) => {
    try {
      parser.middleware(ctxMiddleware).onFinishCommand(data => {
        resolve(data);
      }).fail((msg, err, yargs) => {
        if (msg) {
          if (msg.includes('Unknown argument') || msg.includes('Please specify a command')) {
            yargs = parser;
          }
          return reject(errCode(new Error(msg), 'ERR_YARGS', { yargs }));
        }
        reject(err);
      }).parse(command);
    } catch (err) {
      return reject(err);
    }
  });
}