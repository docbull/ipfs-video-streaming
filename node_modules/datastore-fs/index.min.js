(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.DatastoreFs = factory()}(typeof self !== 'undefined' ? self : this, function () {
var DatastoreFs=(()=>{var es=Object.create;var ge=Object.defineProperty;var ts=Object.getOwnPropertyDescriptor;var rs=Object.getOwnPropertyNames;var ns=Object.getPrototypeOf,ss=Object.prototype.hasOwnProperty;var Nt=t=>ge(t,"__esModule",{value:!0});var w=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),I=(t,e)=>{Nt(t);for(var r in e)ge(t,r,{get:e[r],enumerable:!0})},is=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of rs(e))!ss.call(t,n)&&n!=="default"&&ge(t,n,{get:()=>e[n],enumerable:!(r=ts(e,n))||r.enumerable});return t},C=t=>is(Nt(ge(t!=null?es(ns(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var G=w(()=>{});var L=w(()=>{});var Rt=w((Wo,_t)=>{_t.exports=function(t,e){for(var r=[],n=0;n<t.length;n++){var s=e(t[n],n);os(s)?r.push.apply(r,s):r.push(s)}return r};var os=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"}});var $t=w((Go,Ut)=>{"use strict";Ut.exports=Tt;function Tt(t,e,r){t instanceof RegExp&&(t=Lt(t,r)),e instanceof RegExp&&(e=Lt(e,r));var n=Pt(t,e,r);return n&&{start:n[0],end:n[1],pre:r.slice(0,n[0]),body:r.slice(n[0]+t.length,n[1]),post:r.slice(n[1]+e.length)}}function Lt(t,e){var r=e.match(t);return r?r[0]:null}Tt.range=Pt;function Pt(t,e,r){var n,s,i,o,h,c=r.indexOf(t),d=r.indexOf(e,c+1),a=c;if(c>=0&&d>0){if(t===e)return[c,d];for(n=[],i=r.length;a>=0&&!h;)a==c?(n.push(a),c=r.indexOf(t,a+1)):n.length==1?h=[n.pop(),d]:(s=n.pop(),s<i&&(i=s,o=d),d=r.indexOf(e,a+1)),a=c<d&&c>=0?c:d;n.length&&(h=[i,o])}return h}});var Jt=w((Jo,Gt)=>{var as=Rt(),Bt=$t();Gt.exports=fs;var Kt="\0SLASH"+Math.random()+"\0",zt="\0OPEN"+Math.random()+"\0",Pe="\0CLOSE"+Math.random()+"\0",qt="\0COMMA"+Math.random()+"\0",Vt="\0PERIOD"+Math.random()+"\0";function Ue(t){return parseInt(t,10)==t?parseInt(t,10):t.charCodeAt(0)}function cs(t){return t.split("\\\\").join(Kt).split("\\{").join(zt).split("\\}").join(Pe).split("\\,").join(qt).split("\\.").join(Vt)}function us(t){return t.split(Kt).join("\\").split(zt).join("{").split(Pe).join("}").split(qt).join(",").split(Vt).join(".")}function Wt(t){if(!t)return[""];var e=[],r=Bt("{","}",t);if(!r)return t.split(",");var n=r.pre,s=r.body,i=r.post,o=n.split(",");o[o.length-1]+="{"+s+"}";var h=Wt(i);return i.length&&(o[o.length-1]+=h.shift(),o.push.apply(o,h)),e.push.apply(e,o),e}function fs(t){return t?(t.substr(0,2)==="{}"&&(t="\\{\\}"+t.substr(2)),J(cs(t),!0).map(us)):[]}function hs(t){return"{"+t+"}"}function ls(t){return/^-?0\d/.test(t)}function ds(t,e){return t<=e}function ps(t,e){return t>=e}function J(t,e){var r=[],n=Bt("{","}",t);if(!n||/\$$/.test(n.pre))return[t];var s=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),i=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),o=s||i,h=n.body.indexOf(",")>=0;if(!o&&!h)return n.post.match(/,.*\}/)?(t=n.pre+"{"+n.body+Pe+n.post,J(t)):[t];var c;if(o)c=n.body.split(/\.\./);else if(c=Wt(n.body),c.length===1&&(c=J(c[0],!1).map(hs),c.length===1)){var a=n.post.length?J(n.post,!1):[""];return a.map(function(_e){return n.pre+c[0]+_e})}var d=n.pre,a=n.post.length?J(n.post,!1):[""],f;if(o){var m=Ue(c[0]),v=Ue(c[1]),u=Math.max(c[0].length,c[1].length),l=c.length==3?Math.abs(Ue(c[2])):1,y=ds,p=v<m;p&&(l*=-1,y=ps);var b=c.some(ls);f=[];for(var E=m;y(E,v);E+=l){var g;if(i)g=String.fromCharCode(E),g==="\\"&&(g="");else if(g=String(E),b){var j=u-g.length;if(j>0){var M=new Array(j+1).join("0");E<0?g="-"+M+g.slice(1):g=M+g}}f.push(g)}}else f=as(c,function(ye){return J(ye,!1)});for(var F=0;F<f.length;F++)for(var A=0;A<a.length;A++){var O=d+f[F]+a[A];(!e||o||O)&&r.push(O)}return r}});var tr=w((Ho,er)=>{er.exports=R;R.Minimatch=k;var ae={sep:"/"};try{ae=L()}catch(t){}var $e=R.GLOBSTAR=k.GLOBSTAR={},ms=Jt(),Ht={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},Be="[^/]",Ke=Be+"*?",ys="(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?",gs="(?:(?!(?:\\/|^)\\.).)*?",Xt=bs("().*{}+?[]^$\\!");function bs(t){return t.split("").reduce(function(e,r){return e[r]=!0,e},{})}var Zt=/\/+/;R.filter=ws;function ws(t,e){return e=e||{},function(r,n,s){return R(r,t,e)}}function Yt(t,e){t=t||{},e=e||{};var r={};return Object.keys(e).forEach(function(n){r[n]=e[n]}),Object.keys(t).forEach(function(n){r[n]=t[n]}),r}R.defaults=function(t){if(!t||!Object.keys(t).length)return R;var e=R,r=function(s,i,o){return e.minimatch(s,i,Yt(t,o))};return r.Minimatch=function(s,i){return new e.Minimatch(s,Yt(t,i))},r};k.defaults=function(t){return!t||!Object.keys(t).length?k:R.defaults(t).Minimatch};function R(t,e,r){if(typeof e!="string")throw new TypeError("glob pattern string required");return r||(r={}),!r.nocomment&&e.charAt(0)==="#"?!1:e.trim()===""?t==="":new k(e,r).match(t)}function k(t,e){if(!(this instanceof k))return new k(t,e);if(typeof t!="string")throw new TypeError("glob pattern string required");e||(e={}),t=t.trim(),ae.sep!=="/"&&(t=t.split(ae.sep).join("/")),this.options=e,this.set=[],this.pattern=t,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.make()}k.prototype.debug=function(){};k.prototype.make=vs;function vs(){if(!this._made){var t=this.pattern,e=this.options;if(!e.nocomment&&t.charAt(0)==="#"){this.comment=!0;return}if(!t){this.empty=!0;return}this.parseNegate();var r=this.globSet=this.braceExpand();e.debug&&(this.debug=console.error),this.debug(this.pattern,r),r=this.globParts=r.map(function(n){return n.split(Zt)}),this.debug(this.pattern,r),r=r.map(function(n,s,i){return n.map(this.parse,this)},this),this.debug(this.pattern,r),r=r.filter(function(n){return n.indexOf(!1)===-1}),this.debug(this.pattern,r),this.set=r}}k.prototype.parseNegate=xs;function xs(){var t=this.pattern,e=!1,r=this.options,n=0;if(!r.nonegate){for(var s=0,i=t.length;s<i&&t.charAt(s)==="!";s++)e=!e,n++;n&&(this.pattern=t.substr(n)),this.negate=e}}R.braceExpand=function(t,e){return Qt(t,e)};k.prototype.braceExpand=Qt;function Qt(t,e){if(e||(this instanceof k?e=this.options:e={}),t=typeof t=="undefined"?this.pattern:t,typeof t=="undefined")throw new TypeError("undefined pattern");return e.nobrace||!t.match(/\{.*\}/)?[t]:ms(t)}k.prototype.parse=Es;var be={};function Es(t,e){if(t.length>1024*64)throw new TypeError("pattern is too long");var r=this.options;if(!r.noglobstar&&t==="**")return $e;if(t==="")return"";var n="",s=!!r.nocase,i=!1,o=[],h=[],c,d=!1,a=-1,f=-1,m=t.charAt(0)==="."?"":r.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",v=this;function u(){if(c){switch(c){case"*":n+=Ke,s=!0;break;case"?":n+=Be,s=!0;break;default:n+="\\"+c;break}v.debug("clearStateChar %j %j",c,n),c=!1}}for(var l=0,y=t.length,p;l<y&&(p=t.charAt(l));l++){if(this.debug("%s	%s %s %j",t,l,n,p),i&&Xt[p]){n+="\\"+p,i=!1;continue}switch(p){case"/":return!1;case"\\":u(),i=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s	%s %s %j <-- stateChar",t,l,n,p),d){this.debug("  in class"),p==="!"&&l===f+1&&(p="^"),n+=p;continue}v.debug("call clearStateChar %j",c),u(),c=p,r.noext&&u();continue;case"(":if(d){n+="(";continue}if(!c){n+="\\(";continue}o.push({type:c,start:l-1,reStart:n.length,open:Ht[c].open,close:Ht[c].close}),n+=c==="!"?"(?:(?!(?:":"(?:",this.debug("plType %j %j",c,n),c=!1;continue;case")":if(d||!o.length){n+="\\)";continue}u(),s=!0;var b=o.pop();n+=b.close,b.type==="!"&&h.push(b),b.reEnd=n.length;continue;case"|":if(d||!o.length||i){n+="\\|",i=!1;continue}u(),n+="|";continue;case"[":if(u(),d){n+="\\"+p;continue}d=!0,f=l,a=n.length,n+=p;continue;case"]":if(l===f+1||!d){n+="\\"+p,i=!1;continue}if(d){var E=t.substring(f+1,l);try{RegExp("["+E+"]")}catch(Ot){var g=this.parse(E,be);n=n.substr(0,a)+"\\["+g[0]+"\\]",s=s||g[1],d=!1;continue}}s=!0,d=!1,n+=p;continue;default:u(),i?i=!1:Xt[p]&&!(p==="^"&&d)&&(n+="\\"),n+=p}}for(d&&(E=t.substr(f+1),g=this.parse(E,be),n=n.substr(0,a)+"\\["+g[0],s=s||g[1]),b=o.pop();b;b=o.pop()){var j=n.slice(b.reStart+b.open.length);this.debug("setting tail",n,b),j=j.replace(/((?:\\{2}){0,64})(\\?)\|/g,function(Ot,It,Le){return Le||(Le="\\"),It+It+Le+"|"}),this.debug(`tail=%j
   %s`,j,j,b,n);var M=b.type==="*"?Ke:b.type==="?"?Be:"\\"+b.type;s=!0,n=n.slice(0,b.reStart)+M+"\\("+j}u(),i&&(n+="\\\\");var F=!1;switch(n.charAt(0)){case".":case"[":case"(":F=!0}for(var A=h.length-1;A>-1;A--){var O=h[A],ye=n.slice(0,O.reStart),_e=n.slice(O.reStart,O.reEnd-8),Dt=n.slice(O.reEnd-8,O.reEnd),oe=n.slice(O.reEnd);Dt+=oe;var Zn=ye.split("(").length-1,Re=oe;for(l=0;l<Zn;l++)Re=Re.replace(/\)[+*?]?/,"");oe=Re;var Mt="";oe===""&&e!==be&&(Mt="$");var Yn=ye+_e+oe+Mt+Dt;n=Yn}if(n!==""&&s&&(n="(?=.)"+n),F&&(n=m+n),e===be)return[n,s];if(!s)return js(t);var Qn=r.nocase?"i":"";try{var Te=new RegExp("^"+n+"$",Qn)}catch(Ot){return new RegExp("$.")}return Te._glob=t,Te._src=n,Te}R.makeRe=function(t,e){return new k(t,e||{}).makeRe()};k.prototype.makeRe=Ss;function Ss(){if(this.regexp||this.regexp===!1)return this.regexp;var t=this.set;if(!t.length)return this.regexp=!1,this.regexp;var e=this.options,r=e.noglobstar?Ke:e.dot?ys:gs,n=e.nocase?"i":"",s=t.map(function(i){return i.map(function(o){return o===$e?r:typeof o=="string"?Fs(o):o._src}).join("\\/")}).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,n)}catch(i){this.regexp=!1}return this.regexp}R.match=function(t,e,r){r=r||{};var n=new k(e,r);return t=t.filter(function(s){return n.match(s)}),n.options.nonull&&!t.length&&t.push(e),t};k.prototype.match=Cs;function Cs(t,e){if(this.debug("match",t,this.pattern),this.comment)return!1;if(this.empty)return t==="";if(t==="/"&&e)return!0;var r=this.options;ae.sep!=="/"&&(t=t.split(ae.sep).join("/")),t=t.split(Zt),this.debug(this.pattern,"split",t);var n=this.set;this.debug(this.pattern,"set",n);var s,i;for(i=t.length-1;i>=0&&(s=t[i],!s);i--);for(i=0;i<n.length;i++){var o=n[i],h=t;r.matchBase&&o.length===1&&(h=[s]);var c=this.matchOne(h,o,e);if(c)return r.flipNegate?!0:!this.negate}return r.flipNegate?!1:this.negate}k.prototype.matchOne=function(t,e,r){var n=this.options;this.debug("matchOne",{this:this,file:t,pattern:e}),this.debug("matchOne",t.length,e.length);for(var s=0,i=0,o=t.length,h=e.length;s<o&&i<h;s++,i++){this.debug("matchOne loop");var c=e[i],d=t[s];if(this.debug(e,c,d),c===!1)return!1;if(c===$e){this.debug("GLOBSTAR",[e,c,d]);var a=s,f=i+1;if(f===h){for(this.debug("** at the end");s<o;s++)if(t[s]==="."||t[s]===".."||!n.dot&&t[s].charAt(0)===".")return!1;return!0}for(;a<o;){var m=t[a];if(this.debug(`
globstar while`,t,a,e,f,m),this.matchOne(t.slice(a),e.slice(f),r))return this.debug("globstar found match!",a,o,m),!0;if(m==="."||m===".."||!n.dot&&m.charAt(0)==="."){this.debug("dot detected!",t,a,e,f);break}this.debug("globstar swallow a segment, and continue"),a++}return!!(r&&(this.debug(`
>>> no match, partial?`,t,a,e,f),a===o))}var v;if(typeof c=="string"?(n.nocase?v=d.toLowerCase()===c.toLowerCase():v=d===c,this.debug("string match",c,d,v)):(v=d.match(c),this.debug("pattern match",c,d,v)),!v)return!1}if(s===o&&i===h)return!0;if(s===o)return r;if(i===h){var u=s===o-1&&t[s]==="";return u}throw new Error("wtf?")};function js(t){return t.replace(/\\(.)/g,"$1")}function Fs(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}});var or=w((Xo,ir)=>{"use strict";var rr=G().promises,ce=L(),nr=tr();async function*As(t,e,r={}){let n=ce.resolve(t),s=ce.relative(r.cwd||process.cwd(),t);if((await rr.stat(n)).isDirectory()){for await(let o of sr(n,"",e,r))yield o;return}nr(s,e,r)&&(yield r.absolute?n:s)}async function*sr(t,e,r,n){for await(let s of await rr.opendir(ce.join(t,e))){let i=ce.join(e,s.name),o=ce.join(t,e,s.name),h=nr(i,r,n),c=s.isDirectory();c&&n.nodir&&(h=!1),h&&(yield n.absolute?o:i),c&&(yield*sr(t,i,r,n))}}ir.exports=As});var ze=w(()=>{});var ur=w((Qo,cr)=>{var{promisify:ar}=ze(),K=G(),ks=t=>{if(!t)t={mode:511,fs:K};else if(typeof t=="object")t={mode:511,fs:K,...t};else if(typeof t=="number")t={mode:t,fs:K};else if(typeof t=="string")t={mode:parseInt(t,8),fs:K};else throw new TypeError("invalid options argument");return t.mkdir=t.mkdir||t.fs.mkdir||K.mkdir,t.mkdirAsync=ar(t.mkdir),t.stat=t.stat||t.fs.stat||K.stat,t.statAsync=ar(t.stat),t.statSync=t.statSync||t.fs.statSync||K.statSync,t.mkdirSync=t.mkdirSync||t.fs.mkdirSync||K.mkdirSync,t};cr.exports=ks});var hr=w((ea,fr)=>{var Ds=process.env.__TESTING_MKDIRP_PLATFORM__||process.platform,{resolve:Ms,parse:Os}=L(),Is=t=>{if(/\0/.test(t))throw Object.assign(new TypeError("path must be a string without null bytes"),{path:t,code:"ERR_INVALID_ARG_VALUE"});if(t=Ms(t),Ds==="win32"){let e=/[*|"<>?:]/,{root:r}=Os(t);if(e.test(t.substr(r.length)))throw Object.assign(new Error("Illegal characters in path."),{path:t,code:"EINVAL"})}return t};fr.exports=Is});var yr=w((ta,mr)=>{var{dirname:lr}=L(),dr=(t,e,r=void 0)=>r===e?Promise.resolve():t.statAsync(e).then(n=>n.isDirectory()?r:void 0,n=>n.code==="ENOENT"?dr(t,lr(e),e):void 0),pr=(t,e,r=void 0)=>{if(r!==e)try{return t.statSync(e).isDirectory()?r:void 0}catch(n){return n.code==="ENOENT"?pr(t,lr(e),e):void 0}};mr.exports={findMade:dr,findMadeSync:pr}});var We=w((ra,br)=>{var{dirname:gr}=L(),qe=(t,e,r)=>{e.recursive=!1;let n=gr(t);return n===t?e.mkdirAsync(t,e).catch(s=>{if(s.code!=="EISDIR")throw s}):e.mkdirAsync(t,e).then(()=>r||t,s=>{if(s.code==="ENOENT")return qe(n,e).then(i=>qe(t,e,i));if(s.code!=="EEXIST"&&s.code!=="EROFS")throw s;return e.statAsync(t).then(i=>{if(i.isDirectory())return r;throw s},()=>{throw s})})},Ve=(t,e,r)=>{let n=gr(t);if(e.recursive=!1,n===t)try{return e.mkdirSync(t,e)}catch(s){if(s.code!=="EISDIR")throw s;return}try{return e.mkdirSync(t,e),r||t}catch(s){if(s.code==="ENOENT")return Ve(t,e,Ve(n,e,r));if(s.code!=="EEXIST"&&s.code!=="EROFS")throw s;try{if(!e.statSync(t).isDirectory())throw s}catch(i){throw s}}};br.exports={mkdirpManual:qe,mkdirpManualSync:Ve}});var xr=w((na,vr)=>{var{dirname:wr}=L(),{findMade:Ns,findMadeSync:_s}=yr(),{mkdirpManual:Rs,mkdirpManualSync:Ts}=We(),Ls=(t,e)=>(e.recursive=!0,wr(t)===t?e.mkdirAsync(t,e):Ns(e,t).then(n=>e.mkdirAsync(t,e).then(()=>n).catch(s=>{if(s.code==="ENOENT")return Rs(t,e);throw s}))),Ps=(t,e)=>{if(e.recursive=!0,wr(t)===t)return e.mkdirSync(t,e);let n=_s(e,t);try{return e.mkdirSync(t,e),n}catch(s){if(s.code==="ENOENT")return Ts(t,e);throw s}};vr.exports={mkdirpNative:Ls,mkdirpNativeSync:Ps}});var jr=w((sa,Cr)=>{var Er=G(),Us=process.env.__TESTING_MKDIRP_NODE_VERSION__||process.version,Ge=Us.replace(/^v/,"").split("."),Sr=+Ge[0]>10||+Ge[0]==10&&+Ge[1]>=12,$s=Sr?t=>t.mkdir===Er.mkdir:()=>!1,Bs=Sr?t=>t.mkdirSync===Er.mkdirSync:()=>!1;Cr.exports={useNative:$s,useNativeSync:Bs}});var Or=w((ia,Mr)=>{var H=ur(),X=hr(),{mkdirpNative:Fr,mkdirpNativeSync:Ar}=xr(),{mkdirpManual:kr,mkdirpManualSync:Dr}=We(),{useNative:Ks,useNativeSync:zs}=jr(),Z=(t,e)=>(t=X(t),e=H(e),Ks(e)?Fr(t,e):kr(t,e)),qs=(t,e)=>(t=X(t),e=H(e),zs(e)?Ar(t,e):Dr(t,e));Z.sync=qs;Z.native=(t,e)=>Fr(X(t),H(e));Z.manual=(t,e)=>kr(X(t),H(e));Z.nativeSync=(t,e)=>Ar(X(t),H(e));Z.manualSync=(t,e)=>Dr(X(t),H(e));Mr.exports=Z});var un=w((ic,cn)=>{"use strict";function an(t,e){for(let r in e)Object.defineProperty(t,r,{value:e[r],enumerable:!0,configurable:!0});return t}function Zi(t,e,r){if(!t||typeof t=="string")throw new TypeError("Please pass an Error to err-code");r||(r={}),typeof e=="object"&&(r=e,e=""),e&&(r.code=e);try{return an(t,r)}catch(n){r.message=t.message,r.stack=t.stack;let s=function(){};return s.prototype=Object.create(Object.getPrototypeOf(t)),an(new s,r)}}cn.exports=Zi});var dn=w((hc,ln)=>{"use strict";var Qi=async t=>{let e=[];for await(let r of t)e.push(r);return e};ln.exports=Qi});var bt=w((dc,mn)=>{"use strict";var eo=async t=>{for await(let e of t);};mn.exports=eo});var wt=w((pc,yn)=>{"use strict";var to=async function*(t,e){for await(let r of t)await e(r)&&(yield r)};yn.exports=to});var vt=w((mc,gn)=>{"use strict";var ro=async function*(t,e){let r=0;if(!(e<1)){for await(let n of t)if(yield n,r++,r===e)return}};gn.exports=ro});var St=w((Ec,bn)=>{"use strict";var no=async function*(t,e){for await(let r of t)yield e(r)};bn.exports=no});var xn=w((Sc,re)=>{var wn=(...t)=>{let e;for(;t.length;)e=t.shift()(e);return e},Ct=t=>t&&(typeof t[Symbol.asyncIterator]=="function"||typeof t[Symbol.iterator]=="function"||typeof t.next=="function"),De=t=>t&&typeof t.sink=="function"&&Ct(t.source),so=t=>e=>(t.sink(e),t.source),vn=(...t)=>{if(De(t[0])){let e=t[0];t[0]=()=>e.source}else if(Ct(t[0])){let e=t[0];t[0]=()=>e}if(t.length>1&&De(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let e=1;e<t.length-1;e++)De(t[e])&&(t[e]=so(t[e]));return wn(...t)};re.exports=vn;re.exports.pipe=vn;re.exports.rawPipe=wn;re.exports.isIterable=Ct;re.exports.isDuplex=De});var Cn=w((Rc,Sn)=>{Sn.exports=class{constructor(e){if(!(e>0)||(e-1&e)!=0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){let e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}});var An=w((Lc,Fn)=>{var jn=Cn();Fn.exports=class{constructor(e){this.hwm=e||16,this.head=new jn(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){let r=this.head;this.head=r.next=new jn(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next){let r=this.tail.next;return this.tail.next=null,this.tail=r,this.tail.shift()}return e}isEmpty(){return this.head.isEmpty()}}});var Ft=w((Pc,kn)=>{var jt=An();kn.exports=t=>{t=t||{};let e;typeof t=="function"?(e=t,t={}):e=t.onEnd;let r=new jt,n,s,i,o=()=>{if(!r.isEmpty()){if(t.writev){let l,y=[];for(;!r.isEmpty();){if(l=r.shift(),l.error)throw l.error;y.push(l.value)}return{done:l.done,value:y}}let u=r.shift();if(u.error)throw u.error;return u}return i?{done:!0}:new Promise((u,l)=>{s=y=>(s=null,y.error?l(y.error):t.writev&&!y.done?u({done:y.done,value:[y.value]}):u(y),n)})},h=u=>s?s(u):(r.push(u),n),c=u=>(r=new jt,s?s({error:u}):(r.push({error:u}),n)),d=u=>i?n:h({done:!1,value:u}),a=u=>i?n:(i=!0,u?c(u):h({done:!0})),f=()=>(r=new jt,a(),{done:!0}),m=u=>(a(u),{done:!0});if(n={[Symbol.asyncIterator](){return this},next:o,return:f,throw:m,push:d,end:a},!e)return n;let v=n;return n={[Symbol.asyncIterator](){return this},next(){return v.next()},throw(u){return v.throw(u),e&&(e(u),e=null),{done:!0}},return(){return v.return(),e&&(e(),e=null),{done:!0}},push:d,end(u){return v.end(u),e&&(e(u),e=null),n}},n}});var Mn=w((Uc,Dn)=>{"use strict";var ao=Ft(),co=async function*(...t){let e=ao();setTimeout(async()=>{try{await Promise.all(t.map(async r=>{for await(let n of r)e.push(n)})),e.end()}catch(r){e.end(r)}},0),yield*e};Dn.exports=co});var In=w((qc,On)=>{var ne=1e3,se=ne*60,ie=se*60,V=ie*24,lo=V*7,po=V*365.25;On.exports=function(t,e){e=e||{};var r=typeof t;if(r==="string"&&t.length>0)return mo(t);if(r==="number"&&isFinite(t))return e.long?go(t):yo(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function mo(t){if(t=String(t),!(t.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!!e){var r=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return r*po;case"weeks":case"week":case"w":return r*lo;case"days":case"day":case"d":return r*V;case"hours":case"hour":case"hrs":case"hr":case"h":return r*ie;case"minutes":case"minute":case"mins":case"min":case"m":return r*se;case"seconds":case"second":case"secs":case"sec":case"s":return r*ne;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function yo(t){var e=Math.abs(t);return e>=V?Math.round(t/V)+"d":e>=ie?Math.round(t/ie)+"h":e>=se?Math.round(t/se)+"m":e>=ne?Math.round(t/ne)+"s":t+"ms"}function go(t){var e=Math.abs(t);return e>=V?Me(t,e,V,"day"):e>=ie?Me(t,e,ie,"hour"):e>=se?Me(t,e,se,"minute"):e>=ne?Me(t,e,ne,"second"):t+" ms"}function Me(t,e,r,n){var s=e>=r*1.5;return Math.round(t/r)+" "+n+(s?"s":"")}});var _n=w((Vc,Nn)=>{function bo(t){r.debug=r,r.default=r,r.coerce=c,r.disable=i,r.enable=s,r.enabled=o,r.humanize=In(),r.destroy=d,Object.keys(t).forEach(a=>{r[a]=t[a]}),r.names=[],r.skips=[],r.formatters={};function e(a){let f=0;for(let m=0;m<a.length;m++)f=(f<<5)-f+a.charCodeAt(m),f|=0;return r.colors[Math.abs(f)%r.colors.length]}r.selectColor=e;function r(a){let f,m=null,v,u;function l(...y){if(!l.enabled)return;let p=l,b=Number(new Date),E=b-(f||b);p.diff=E,p.prev=f,p.curr=b,f=b,y[0]=r.coerce(y[0]),typeof y[0]!="string"&&y.unshift("%O");let g=0;y[0]=y[0].replace(/%([a-zA-Z%])/g,(M,F)=>{if(M==="%%")return"%";g++;let A=r.formatters[F];if(typeof A=="function"){let O=y[g];M=A.call(p,O),y.splice(g,1),g--}return M}),r.formatArgs.call(p,y),(p.log||r.log).apply(p,y)}return l.namespace=a,l.useColors=r.useColors(),l.color=r.selectColor(a),l.extend=n,l.destroy=r.destroy,Object.defineProperty(l,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(v!==r.namespaces&&(v=r.namespaces,u=r.enabled(a)),u),set:y=>{m=y}}),typeof r.init=="function"&&r.init(l),l}function n(a,f){let m=r(this.namespace+(typeof f=="undefined"?":":f)+a);return m.log=this.log,m}function s(a){r.save(a),r.namespaces=a,r.names=[],r.skips=[];let f,m=(typeof a=="string"?a:"").split(/[\s,]+/),v=m.length;for(f=0;f<v;f++)!m[f]||(a=m[f].replace(/\*/g,".*?"),a[0]==="-"?r.skips.push(new RegExp("^"+a.substr(1)+"$")):r.names.push(new RegExp("^"+a+"$")))}function i(){let a=[...r.names.map(h),...r.skips.map(h).map(f=>"-"+f)].join(",");return r.enable(""),a}function o(a){if(a[a.length-1]==="*")return!0;let f,m;for(f=0,m=r.skips.length;f<m;f++)if(r.skips[f].test(a))return!1;for(f=0,m=r.names.length;f<m;f++)if(r.names[f].test(a))return!0;return!1}function h(a){return a.toString().substring(2,a.toString().length-2).replace(/\.\*\?$/,"*")}function c(a){return a instanceof Error?a.stack||a.message:a}function d(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.enable(r.load()),r}Nn.exports=bo});var Rn=w((N,Oe)=>{N.formatArgs=vo;N.save=xo;N.load=Eo;N.useColors=wo;N.storage=So();N.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();N.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function wo(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function vo(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+Oe.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;t.splice(1,0,e,"color: inherit");let r=0,n=0;t[0].replace(/%[a-zA-Z%]/g,s=>{s!=="%%"&&(r++,s==="%c"&&(n=r))}),t.splice(n,0,e)}N.log=console.debug||console.log||(()=>{});function xo(t){try{t?N.storage.setItem("debug",t):N.storage.removeItem("debug")}catch(e){}}function Eo(){let t;try{t=N.storage.getItem("debug")}catch(e){}return!t&&typeof process!="undefined"&&"env"in process&&(t=process.env.DEBUG),t}function So(){try{return localStorage}catch(t){}}Oe.exports=_n()(N);var{formatters:Co}=Oe.exports;Co.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Pn=w((du,Ln)=>{"use strict";async function*Ao(t,e=1){let r=[];e<1&&(e=1);for await(let n of t)for(r.push(n);r.length>=e;)yield r.slice(0,e),r=r.slice(e);for(;r.length;)yield r.slice(0,e),r=r.slice(e)}Ln.exports=Ao});var $n=w((pu,Un)=>{"use strict";var ko=Pn();async function*Do(t,e=1){for await(let r of ko(t,e)){let n=r.map(s=>s().then(i=>({ok:!0,value:i}),i=>({ok:!1,err:i})));for(let s=0;s<n.length;s++){let i=await n[s];if(i.ok)yield i.value;else throw i.err}}}Un.exports=Do});var Wn=w((mu,Vn)=>{"use strict";var{open:Mo,write:Oo,close:Bn,rename:Io,fsync:No,unlink:_o}=G(),{join:Ro,dirname:To}=L(),Lo=0;function At(t,e,r){_o(t,function(){r(e)})}function Kn(t,e,r,n){Bn(t,At.bind(null,e,r,n))}function zn(t,e,r,n,s){Oo(t,e,n,function(i,o){if(i){s(i);return}return o<r-n?zn(t,e,r,n+o,s):s(null)})}function qn(t,e){Mo(t,"w",function(r,n){if(r)return r.code==="EMFILE"?qn(t,e):e(r);e(null,n)})}function Po(t,e,r){let n=Ro(To(t),"."+process.pid+"."+Lo++);qn(n,function(s,i){if(s){r(s);return}let o=Buffer.byteLength(e);zn(i,e,o,0,function(h){if(h){Kn(i,n,h,r);return}No(i,function(c){if(c){Kn(i,n,c,r);return}Bn(i,function(d){if(d){At(n,d,r);return}Io(n,t,a=>{if(a){At(n,a,r);return}r(null)})})})}),e=null})}Vn.exports=Po});var $o={};I($o,{FsDatastore:()=>Xn});var _=C(G()),kt=C(or()),Ie=C(Or()),B=C(L()),Gn=C(ze());var Ir=(t=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let n=r[t]&63;n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n<63?e+="_":e+="-"}return e};var Je={};I(Je,{identity:()=>Xs});function Vs(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),n=0;n<r.length;n++)r[n]=255;for(var s=0;s<t.length;s++){var i=t.charAt(s),o=i.charCodeAt(0);if(r[o]!==255)throw new TypeError(i+" is ambiguous");r[o]=s}var h=t.length,c=t.charAt(0),d=Math.log(h)/Math.log(256),a=Math.log(256)/Math.log(h);function f(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";for(var l=0,y=0,p=0,b=u.length;p!==b&&u[p]===0;)p++,l++;for(var E=(b-p)*a+1>>>0,g=new Uint8Array(E);p!==b;){for(var j=u[p],M=0,F=E-1;(j!==0||M<y)&&F!==-1;F--,M++)j+=256*g[F]>>>0,g[F]=j%h>>>0,j=j/h>>>0;if(j!==0)throw new Error("Non-zero carry");y=M,p++}for(var A=E-y;A!==E&&g[A]===0;)A++;for(var O=c.repeat(l);A<E;++A)O+=t.charAt(g[A]);return O}function m(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;var l=0;if(u[l]!==" "){for(var y=0,p=0;u[l]===c;)y++,l++;for(var b=(u.length-l)*d+1>>>0,E=new Uint8Array(b);u[l];){var g=r[u.charCodeAt(l)];if(g===255)return;for(var j=0,M=b-1;(g!==0||j<p)&&M!==-1;M--,j++)g+=h*E[M]>>>0,E[M]=g%256>>>0,g=g/256>>>0;if(g!==0)throw new Error("Non-zero carry");p=j,l++}if(u[l]!==" "){for(var F=b-p;F!==b&&E[F]===0;)F++;for(var A=new Uint8Array(y+(b-F)),O=y;F!==b;)A[O++]=E[F++];return A}}}function v(u){var l=m(u);if(l)return l;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:m,decode:v}}var Ws=Vs,Gs=Ws,Nr=Gs;var ha=new Uint8Array(0);var _r=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let r=0;r<t.byteLength;r++)if(t[r]!==e[r])return!1;return!0},P=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")};var Rr=t=>new TextEncoder().encode(t),Tr=t=>new TextDecoder().decode(t);var Pr=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Ur=class{constructor(e,r,n){this.name=e,this.prefix=r,this.baseDecode=n}decode(e){if(typeof e=="string")switch(e[0]){case this.prefix:return this.baseDecode(e.slice(1));default:throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}else throw Error("Can only multibase decode strings")}or(e){return Br(this,e)}},$r=class{constructor(e){this.decoders=e}or(e){return Br(this,e)}decode(e){let r=e[0],n=this.decoders[r];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Br=(t,e)=>new $r({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}}),Kr=class{constructor(e,r,n,s){this.name=e,this.prefix=r,this.baseEncode=n,this.baseDecode=s,this.encoder=new Pr(e,r,n),this.decoder=new Ur(e,r,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},we=({name:t,prefix:e,encode:r,decode:n})=>new Kr(t,e,r,n),z=({prefix:t,name:e,alphabet:r})=>{let{encode:n,decode:s}=Nr(r,e);return we({prefix:t,name:e,encode:n,decode:i=>P(s(i))})},Js=(t,e,r,n)=>{let s={};for(let a=0;a<e.length;++a)s[e[a]]=a;let i=t.length;for(;t[i-1]==="=";)--i;let o=new Uint8Array(i*r/8|0),h=0,c=0,d=0;for(let a=0;a<i;++a){let f=s[t[a]];if(f===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<r|f,h+=r,h>=8&&(h-=8,o[d++]=255&c>>h)}if(h>=r||255&c<<8-h)throw new SyntaxError("Unexpected end of data");return o},Hs=(t,e,r)=>{let n=e[e.length-1]==="=",s=(1<<r)-1,i="",o=0,h=0;for(let c=0;c<t.length;++c)for(h=h<<8|t[c],o+=8;o>r;)o-=r,i+=e[s&h>>o];if(o&&(i+=e[s&h<<r-o]),n)for(;i.length*r&7;)i+="=";return i},S=({name:t,prefix:e,bitsPerChar:r,alphabet:n})=>we({prefix:e,name:t,encode(s){return Hs(s,n,r)},decode(s){return Js(s,n,r,t)}});var Xs=we({prefix:"\0",name:"identity",encode:t=>Tr(t),decode:t=>Rr(t)});var He={};I(He,{base2:()=>Zs});var Zs=S({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Xe={};I(Xe,{base8:()=>Ys});var Ys=S({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ze={};I(Ze,{base10:()=>Qs});var Qs=z({prefix:"9",name:"base10",alphabet:"0123456789"});var Ye={};I(Ye,{base16:()=>ei,base16upper:()=>ti});var ei=S({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ti=S({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Qe={};I(Qe,{base32:()=>Y,base32hex:()=>ii,base32hexpad:()=>ai,base32hexpadupper:()=>ci,base32hexupper:()=>oi,base32pad:()=>ni,base32padupper:()=>si,base32upper:()=>ri,base32z:()=>ui});var Y=S({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),ri=S({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),ni=S({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),si=S({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),ii=S({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),oi=S({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ai=S({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),ci=S({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ui=S({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var et={};I(et,{base36:()=>fi,base36upper:()=>hi});var fi=z({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),hi=z({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var tt={};I(tt,{base58btc:()=>T,base58flickr:()=>li});var T=z({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),li=z({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var rt={};I(rt,{base64:()=>di,base64pad:()=>pi,base64url:()=>mi,base64urlpad:()=>yi});var di=S({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),pi=S({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),mi=S({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),yi=S({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var st={};I(st,{sha256:()=>Ri,sha512:()=>Ti});var gi=qr,zr=128,bi=127,wi=~bi,vi=Math.pow(2,31);function qr(t,e,r){e=e||[],r=r||0;for(var n=r;t>=vi;)e[r++]=t&255|zr,t/=128;for(;t&wi;)e[r++]=t&255|zr,t>>>=7;return e[r]=t|0,qr.bytes=r-n+1,e}var xi=nt,Ei=128,Vr=127;function nt(t,e){var r=0,e=e||0,n=0,s=e,i,o=t.length;do{if(s>=o)throw nt.bytes=0,new RangeError("Could not decode varint");i=t[s++],r+=n<28?(i&Vr)<<n:(i&Vr)*Math.pow(2,n),n+=7}while(i>=Ei);return nt.bytes=s-e,r}var Si=Math.pow(2,7),Ci=Math.pow(2,14),ji=Math.pow(2,21),Fi=Math.pow(2,28),Ai=Math.pow(2,35),ki=Math.pow(2,42),Di=Math.pow(2,49),Mi=Math.pow(2,56),Oi=Math.pow(2,63),Ii=function(t){return t<Si?1:t<Ci?2:t<ji?3:t<Fi?4:t<Ai?5:t<ki?6:t<Di?7:t<Mi?8:t<Oi?9:10},Ni={encode:gi,decode:xi,encodingLength:Ii},_i=Ni,ue=_i;var fe=t=>[ue.decode(t),ue.decode.bytes],Q=(t,e,r=0)=>(ue.encode(t,e,r),e),ee=t=>ue.encodingLength(t);var ve=(t,e)=>{let r=e.byteLength,n=ee(t),s=n+ee(r),i=new Uint8Array(s+r);return Q(t,i,0),Q(r,i,n),i.set(e,s),new he(t,r,e,i)},Gr=t=>{let e=P(t),[r,n]=fe(e),[s,i]=fe(e.subarray(n)),o=e.subarray(n+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new he(r,s,o,e)},Jr=(t,e)=>t===e?!0:t.code===e.code&&t.size===e.size&&_r(t.bytes,e.bytes),he=class{constructor(e,r,n,s){this.code=e,this.size=r,this.digest=n,this.bytes=s}};var le=({name:t,code:e,encode:r})=>new Xr(t,e,r),Xr=class{constructor(e,r,n){this.name=e,this.code=r,this.encode=n}async digest(e){if(e instanceof Uint8Array){let r=await this.encode(e);return ve(this.code,r)}else throw Error("Unknown type, must be binary type")}};var Yr=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Ri=le({name:"sha2-256",code:18,encode:Yr("SHA-256")}),Ti=le({name:"sha2-512",code:19,encode:Yr("SHA-512")});var it={};I(it,{identity:()=>Li});var Li=le({name:"identity",code:0,encode:t=>P(t)});var _a=new TextEncoder,Ra=new TextDecoder;var D=class{constructor(e,r,n,s){this.code=r,this.version=e,this.multihash=n,this.bytes=s,this.byteOffset=s.byteOffset,this.byteLength=s.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:Ee,byteLength:Ee,code:xe,version:xe,multihash:xe,bytes:xe,_baseCache:Ee,asCID:Ee})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:r}=this;if(e!==de)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(r.code!==zi)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return D.createV0(r)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:r}=this.multihash,n=ve(e,r);return D.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Jr(this.multihash,e.multihash)}toString(e){let{bytes:r,version:n,_baseCache:s}=this;switch(n){case 0:return Bi(r,s,e||T.encoder);default:return Ki(r,s,e||Y.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return Vi(/^0\.0/,Wi),!!(e&&(e[en]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof D)return e;if(e!=null&&e.asCID===e){let{version:r,code:n,multihash:s,bytes:i}=e;return new D(r,n,s,i||Qr(r,n,s.bytes))}else if(e!=null&&e[en]===!0){let{version:r,multihash:n,code:s}=e,i=Gr(n);return D.create(r,s,i)}else return null}static create(e,r,n){if(typeof r!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(r!==de)throw new Error(`Version 0 CID must use dag-pb (code: ${de}) block encoding`);return new D(e,r,n,n.bytes)}case 1:{let s=Qr(e,r,n.bytes);return new D(e,r,n,s)}default:throw new Error("Invalid version")}}static createV0(e){return D.create(0,de,e)}static createV1(e,r){return D.create(1,e,r)}static decode(e){let[r,n]=D.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return r}static decodeFirst(e){let r=D.inspectBytes(e),n=r.size-r.multihashSize,s=P(e.subarray(n,n+r.multihashSize));if(s.byteLength!==r.multihashSize)throw new Error("Incorrect length");let i=s.subarray(r.multihashSize-r.digestSize),o=new he(r.multihashCode,r.digestSize,i,s);return[r.version===0?D.createV0(o):D.createV1(r.codec,o),e.subarray(r.size)]}static inspectBytes(e){let r=0,n=()=>{let[f,m]=fe(e.subarray(r));return r+=m,f},s=n(),i=de;if(s===18?(s=0,r=0):s===1&&(i=n()),s!==0&&s!==1)throw new RangeError(`Invalid CID version ${s}`);let o=r,h=n(),c=n(),d=r+c,a=d-o;return{version:s,codec:i,multihashCode:h,digestSize:c,multihashSize:a,size:d}}static parse(e,r){let[n,s]=$i(e,r),i=D.decode(s);return i._baseCache.set(n,e),i}},$i=(t,e)=>{switch(t[0]){case"Q":{let r=e||T;return[T.prefix,r.decode(`${T.prefix}${t}`)]}case T.prefix:{let r=e||T;return[T.prefix,r.decode(t)]}case Y.prefix:{let r=e||Y;return[Y.prefix,r.decode(t)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}}},Bi=(t,e,r)=>{let{prefix:n}=r;if(n!==T.prefix)throw Error(`Cannot string encode V0 in ${r.name} encoding`);let s=e.get(n);if(s==null){let i=r.encode(t).slice(1);return e.set(n,i),i}else return s},Ki=(t,e,r)=>{let{prefix:n}=r,s=e.get(n);if(s==null){let i=r.encode(t);return e.set(n,i),i}else return s},de=112,zi=18,Qr=(t,e,r)=>{let n=ee(t),s=n+ee(e),i=new Uint8Array(s+r.byteLength);return Q(t,i,0),Q(e,i,n),i.set(r,s),i},en=Symbol.for("@ipld/js-cid/CID"),xe={writable:!1,configurable:!1,enumerable:!0},Ee={writable:!1,enumerable:!1,configurable:!1},qi="0.0.0-dev",Vi=(t,e)=>{if(t.test(qi))console.warn(e);else throw new Error(e)},Wi=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var ot={...Je,...He,...Xe,...Ze,...Ye,...Qe,...et,...tt,...rt},Va={...st,...it};function tn(t,e,r,n){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:n}}}var rn=tn("utf8","u",t=>{let e=new TextDecoder("utf8");return"u"+e.decode(t)},t=>new TextEncoder().encode(t.substring(1))),at=tn("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);let e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Gi={utf8:rn,"utf-8":rn,hex:ot.base16,latin1:at,ascii:at,binary:at,...ot},Se=Gi;function nn(t,e="utf8"){let r=Se[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return r.encoder.encode(t).substring(1)}function sn(t,e="utf8"){let r=Se[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return r.decoder.decode(`${r.prefix}${t}`)}var U="/",on=new TextEncoder().encode(U),Ce=on[0],x=class{constructor(e,r){if(typeof e=="string")this._buf=sn(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(r==null&&(r=!0),r&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Ce)throw new Error("Invalid key")}toString(e="utf8"){return nn(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new x(e.join(U))}static random(){return new x(Ir().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new x(e):e.uint8Array?new x(e.uint8Array()):null}clean(){if((!this._buf||this._buf.byteLength===0)&&(this._buf=on),this._buf[0]!==Ce){let e=new Uint8Array(this._buf.byteLength+1);e.fill(Ce,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Ce;)this._buf=this._buf.subarray(0,-1)}less(e){let r=this.list(),n=e.list();for(let s=0;s<r.length;s++){if(n.length<s+1)return!1;let i=r[s],o=n[s];if(i<o)return!0;if(i>o)return!1}return r.length<n.length}reverse(){return x.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){let e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(U).slice(1)}type(){return Ji(this.baseNamespace())}name(){return Hi(this.baseNamespace())}instance(e){return new x(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(U)||(e+=U),e+=this.type(),new x(e)}parent(){let e=this.list();return e.length===1?new x(U):new x(e.slice(0,-1).join(U))}child(e){return this.toString()===U?e:e.toString()===U?this:new x(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return x.withNamespaces([...this.namespaces(),...Xi(e.map(r=>r.namespaces()))])}};function Ji(t){let e=t.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function Hi(t){let e=t.split(":");return e[e.length-1]}function Xi(t){return[].concat(...t)}var ht={};I(ht,{abortedError:()=>Yi,dbDeleteFailedError:()=>ut,dbOpenFailedError:()=>ct,dbWriteFailedError:()=>ft,notFoundError:()=>je});var te=C(un());function ct(t){return t=t||new Error("Cannot open database"),(0,te.default)(t,"ERR_DB_OPEN_FAILED")}function ut(t){return t=t||new Error("Delete failed"),(0,te.default)(t,"ERR_DB_DELETE_FAILED")}function ft(t){return t=t||new Error("Write failed"),(0,te.default)(t,"ERR_DB_WRITE_FAILED")}function je(t){return t=t||new Error("Not Found"),(0,te.default)(t,"ERR_NOT_FOUND")}function Yi(t){return t=t||new Error("Aborted"),(0,te.default)(t,"ERR_ABORTED")}var gt={};I(gt,{NextToLast:()=>yt,PREFIX:()=>Fe,Prefix:()=>pt,README_FN:()=>dt,SHARDING_FN:()=>Ae,ShardBase:()=>pe,Suffix:()=>mt,parseShardFun:()=>fn,readShardFun:()=>hn,readme:()=>lt});var lt=`This is a repository of IPLD objects. Each IPLD object is in a single file,
named <base32 encoding of cid>.data. Where <base32 encoding of cid> is the
"base32" encoding of the CID (as specified in
https://github.com/multiformats/multibase) without the 'B' prefix.
All the object files are placed in a tree of directories, based on a
function of the CID. This is a form of sharding similar to
the objects directory in git repositories. Previously, we used
prefixes, we now use the next-to-last two charters.
    func NextToLast(base32cid string) {
      nextToLastLen := 2
      offset := len(base32cid) - nextToLastLen - 1
      return str[offset : offset+nextToLastLen]
    }
For example, an object with a base58 CIDv1 of
    zb2rhYSxw4ZjuzgCnWSt19Q94ERaeFhu9uSqRgjSdx9bsgM6f
has a base32 CIDv1 of
    BAFKREIA22FLID5AJ2KU7URG47MDLROZIH6YF2KALU2PWEFPVI37YLKRSCA
and will be placed at
    SC/AFKREIA22FLID5AJ2KU7URG47MDLROZIH6YF2KALU2PWEFPVI37YLKRSCA.data
with 'SC' being the last-to-next two characters and the 'B' at the
beginning of the CIDv1 string is the multibase prefix that is not
stored in the filename.
`;var Fe="/repo/flatfs/shard/",Ae="SHARDING",dt="_README",pe=class{constructor(e){this.param=e,this.name="base",this._padding=""}fun(e){return"implement me"}toString(){return`${Fe}v1/${this.name}/${this.param}`}},pt=class extends pe{constructor(e){super(e);this._padding="".padStart(e,"_"),this.name="prefix"}fun(e){return(e+this._padding).slice(0,this.param)}},mt=class extends pe{constructor(e){super(e);this._padding="".padStart(e,"_"),this.name="suffix"}fun(e){let r=this._padding+e;return r.slice(r.length-this.param)}},yt=class extends pe{constructor(e){super(e);this._padding="".padStart(e+1,"_"),this.name="next-to-last"}fun(e){let r=this._padding+e,n=r.length-this.param-1;return r.slice(n,n+this.param)}};function fn(t){if(t=t.trim(),t.length===0)throw new Error("empty shard string");if(!t.startsWith(Fe))throw new Error(`invalid or no path prefix: ${t}`);let e=t.slice(Fe.length).split("/"),r=e[0];if(r!=="v1")throw new Error(`expect 'v1' version, got '${r}'`);let n=e[1];if(!e[2])throw new Error("missing param");let s=parseInt(e[2],10);switch(n){case"prefix":return new pt(s);case"suffix":return new mt(s);case"next-to-last":return new yt(s);default:throw new Error(`unkown sharding function: ${n}`)}}var hn=async(t,e)=>{let r=new x(t).child(new x(Ae)),s=await(typeof e.getRaw=="function"?e.getRaw.bind(e):e.get.bind(e))(r);return fn(new TextDecoder().decode(s||"").trim())};var pn=C(dn()),ke=(t,e)=>async function*(){yield*(await(0,pn.default)(t)).sort(e)}();var xt=C(bt()),q=C(wt()),Et=C(vt()),$=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,r,n){return Promise.reject(new Error(".put is not implemented"))}get(e,r){return Promise.reject(new Error(".get is not implemented"))}has(e,r){return Promise.reject(new Error(".has is not implemented"))}delete(e,r){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,r={}){for await(let{key:n,value:s}of e)await this.put(n,s,r),yield{key:n,value:s}}async*getMany(e,r={}){for await(let n of e)yield this.get(n,r)}async*deleteMany(e,r={}){for await(let n of e)await this.delete(n,r),yield n}batch(){let e=[],r=[];return{put(n,s){e.push({key:n,value:s})},delete(n){r.push(n)},commit:async n=>{await(0,xt.default)(this.putMany(e,n)),e=[],await(0,xt.default)(this.deleteMany(r,n)),r=[]}}}async*_all(e,r){throw new Error("._all is not implemented")}async*_allKeys(e,r){throw new Error("._allKeys is not implemented")}query(e,r){let n=this._all(e,r);if(e.prefix!=null&&(n=(0,q.default)(n,s=>s.key.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>(0,q.default)(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>ke(s,i),n)),e.offset!=null){let s=0;n=(0,q.default)(n,()=>s++>=e.offset)}return e.limit!=null&&(n=(0,Et.default)(n,e.limit)),n}queryKeys(e,r){let n=this._allKeys(e,r);if(e.prefix!=null&&(n=(0,q.default)(n,s=>s.toString().startsWith(e.prefix))),Array.isArray(e.filters)&&(n=e.filters.reduce((s,i)=>(0,q.default)(s,i),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((s,i)=>ke(s,i),n)),e.offset!=null){let s=0;n=(0,q.default)(n,()=>s++>=e.offset)}return e.limit!=null&&(n=(0,Et.default)(n,e.limit)),n}};var io=C(St()),oo=C(xn());var Oc=new x(Ae),Ic=new x(dt);var uo=C(wt()),fo=C(vt()),ho=C(Mn());var Tn=C(Rn()),jo=C(Ft()),Fo=C(bt()),Jc=(0,Tn.default)("datastore:core:tiered");var W={...ht},su={...gt};var me=C(St()),Ne=C($n()),Jn=C(Wn()),Uo=(0,Gn.promisify)(Jn.default);async function Hn(t,e){try{await Uo(t,e)}catch(r){if(r.code==="EPERM"&&r.syscall==="rename"){await _.default.promises.access(t,_.default.constants.F_OK|_.default.constants.W_OK);return}throw r}}var Xn=class extends ${constructor(e,r){super();this.path=B.default.resolve(e),this.opts=Object.assign({},{createIfMissing:!0,errorIfExists:!1,extension:".data",deleteManyConcurrency:50,getManyConcurrency:50,putManyConcurrency:50},r)}open(){try{if(!_.default.existsSync(this.path))throw W.notFoundError(new Error(`Datastore directory: ${this.path} does not exist`));if(this.opts.errorIfExists)throw W.dbOpenFailedError(new Error(`Datastore directory: ${this.path} already exists`));return Promise.resolve()}catch(e){if(e.code==="ERR_NOT_FOUND"&&this.opts.createIfMissing)return Ie.default.sync(this.path,{fs:_.default}),Promise.resolve();throw e}}close(){return Promise.resolve()}_encode(e){let r=e.parent().toString(),n=B.default.join(this.path,r),s=e.toString().slice(r.length),i=B.default.join(n,s+this.opts.extension);return{dir:n,file:i}}_decode(e){let r=this.opts.extension;if(B.default.extname(e)!==r)throw new Error(`Invalid extension: ${B.default.extname(e)}`);let n=e.slice(this.path.length,-r.length).split(B.default.sep).join("/");return new x(n)}async putRaw(e,r){let n=this._encode(e),s=n.file;this.opts.extension.length&&(s=n.file.slice(0,-this.opts.extension.length)),await(0,Ie.default)(n.dir,{fs:_.default}),await Hn(s,r)}async put(e,r){let n=this._encode(e);try{await(0,Ie.default)(n.dir,{fs:_.default}),await Hn(n.file,r)}catch(s){throw W.dbWriteFailedError(s)}}async*putMany(e){yield*(0,Ne.default)((0,me.default)(e,({key:r,value:n})=>async()=>(await this.put(r,n),{key:r,value:n})),this.opts.putManyConcurrency)}async getRaw(e){let n=this._encode(e).file;this.opts.extension.length&&(n=n.slice(0,-this.opts.extension.length));let s;try{s=await _.default.promises.readFile(n)}catch(i){throw W.notFoundError(i)}return s}async get(e){let r=this._encode(e),n;try{n=await _.default.promises.readFile(r.file)}catch(s){throw W.notFoundError(s)}return n}async*getMany(e){yield*(0,Ne.default)((0,me.default)(e,r=>async()=>this.get(r)),this.opts.getManyConcurrency)}async*deleteMany(e){yield*(0,Ne.default)((0,me.default)(e,r=>async()=>(await this.delete(r),r)),this.opts.deleteManyConcurrency)}async has(e){let r=this._encode(e);try{await _.default.promises.access(r.file)}catch(n){return!1}return!0}async delete(e){let r=this._encode(e);try{await _.default.promises.unlink(r.file)}catch(n){if(n.code==="ENOENT")return;throw W.dbDeleteFailedError(n)}}async*_all(e){let r=e.prefix||"**";r=r.replace(/^\/+/,"");let n=`${r}/*${this.opts.extension}`.split(B.default.sep).join("/"),s=(0,kt.default)(this.path,n,{absolute:!0});for await(let i of s)try{let o=await _.default.promises.readFile(i);yield{key:this._decode(i),value:o}}catch(o){if(o.code!=="ENOENT")throw o}}async*_allKeys(e){let r=e.prefix||"**";r=r.replace(/^\/+/,"");let n=`${r}/*${this.opts.extension}`.split(B.default.sep).join("/"),s=(0,kt.default)(this.path,n,{absolute:!0});yield*(0,me.default)(s,i=>this._decode(i))}};return $o;})();
return DatastoreFs}));
