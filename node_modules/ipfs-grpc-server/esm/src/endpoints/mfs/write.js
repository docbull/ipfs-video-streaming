import peekable from 'it-peekable';
import map from 'it-map';
import { callbackify } from 'util';
export function grpcMfsWrite(ipfs, options = {}) {
  async function mfsWrite(source, metadata) {
    const opts = { ...metadata };
    if (opts.mtime) {
      opts.mtime = {
        secs: opts.mtime,
        nsecs: opts.mtimeNsecs
      };
    }
    const content = peekable(source);
    const result = await content.peek();
    const {
      value: {path}
    } = result;
    content.push(result.value);
    await ipfs.files.write(path, map(content, ({content}) => content), opts);
    return {};
  }
  return callbackify(mfsWrite);
}