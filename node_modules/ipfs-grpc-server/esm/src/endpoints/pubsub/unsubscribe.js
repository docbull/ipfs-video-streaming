import { subscriptions } from './subscriptions.js';
import { callbackify } from 'util';
export function grpcPubsubUnsubscribe(ipfs, options = {}) {
  async function pubsubUnsubscribe(request, metadata) {
    const opts = { ...metadata };
    if (!request.handlers || !request.handlers.length) {
      await ipfs.pubsub.unsubscribe(request.topic, undefined, opts);
      return {};
    }
    for (const handlerId of request.handlers) {
      const handler = subscriptions.get(handlerId);
      if (!handler) {
        continue;
      }
      await ipfs.pubsub.unsubscribe(request.topic, handler.onMessage, opts);
      handler.onUnsubscribe();
      subscriptions.delete(handlerId);
    }
    return {};
  }
  return callbackify(pubsubUnsubscribe);
}