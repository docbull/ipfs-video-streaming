'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var peekable = require('it-peekable');
var map = require('it-map');
var util = require('util');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var peekable__default = /*#__PURE__*/_interopDefaultLegacy(peekable);
var map__default = /*#__PURE__*/_interopDefaultLegacy(map);

function grpcMfsWrite(ipfs, options = {}) {
  async function mfsWrite(source, metadata) {
    const opts = { ...metadata };
    if (opts.mtime) {
      opts.mtime = {
        secs: opts.mtime,
        nsecs: opts.mtimeNsecs
      };
    }
    const content = peekable__default["default"](source);
    const result = await content.peek();
    const {
      value: {path}
    } = result;
    content.push(result.value);
    await ipfs.files.write(path, map__default["default"](content, ({content}) => content), opts);
    return {};
  }
  return util.callbackify(mfsWrite);
}

exports.grpcMfsWrite = grpcMfsWrite;
