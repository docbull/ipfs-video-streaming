'use strict';

Object.defineProperty(exports, '__esModule', { value: true });

var subscriptions = require('./subscriptions.js');
var util = require('util');

function grpcPubsubUnsubscribe(ipfs, options = {}) {
  async function pubsubUnsubscribe(request, metadata) {
    const opts = { ...metadata };
    if (!request.handlers || !request.handlers.length) {
      await ipfs.pubsub.unsubscribe(request.topic, undefined, opts);
      return {};
    }
    for (const handlerId of request.handlers) {
      const handler = subscriptions.subscriptions.get(handlerId);
      if (!handler) {
        continue;
      }
      await ipfs.pubsub.unsubscribe(request.topic, handler.onMessage, opts);
      handler.onUnsubscribe();
      subscriptions.subscriptions.delete(handlerId);
    }
    return {};
  }
  return util.callbackify(pubsubUnsubscribe);
}

exports.grpcPubsubUnsubscribe = grpcPubsubUnsubscribe;
