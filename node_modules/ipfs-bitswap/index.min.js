(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.IpfsBitswap = factory()}(typeof self !== 'undefined' ? self : this, function () {
var IpfsBitswap=(()=>{var la=Object.create;var st=Object.defineProperty;var ha=Object.getOwnPropertyDescriptor;var fa=Object.getOwnPropertyNames;var pa=Object.getPrototypeOf,da=Object.prototype.hasOwnProperty;var Kr=r=>st(r,"__esModule",{value:!0});var ya=(r,e)=>()=>(r&&(e=r(r=0)),e);var m=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports),J=(r,e)=>{Kr(r);for(var t in e)st(r,t,{get:e[t],enumerable:!0})},ga=(r,e,t)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of fa(e))!da.call(r,n)&&n!=="default"&&st(r,n,{get:()=>e[n],enumerable:!(t=ha(e,n))||t.enumerable});return r},T=r=>ga(Kr(st(r!=null?la(pa(r)):{},"default",r&&r.__esModule&&"default"in r?{get:()=>r.default,enumerable:!0}:{value:r,enumerable:!0})),r);var en=m(ot=>{u();"use strict";ot.byteLength=wa;ot.toByteArray=_a;ot.fromByteArray=va;var ne=[],Q=[],ma=typeof Uint8Array!="undefined"?Uint8Array:Array,Ft="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(Be=0,Zr=Ft.length;Be<Zr;++Be)ne[Be]=Ft[Be],Q[Ft.charCodeAt(Be)]=Be;var Be,Zr;Q["-".charCodeAt(0)]=62;Q["_".charCodeAt(0)]=63;function Yr(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=r.indexOf("=");t===-1&&(t=e);var n=t===e?0:4-t%4;return[t,n]}function wa(r){var e=Yr(r),t=e[0],n=e[1];return(t+n)*3/4-n}function ba(r,e,t){return(e+t)*3/4-t}function _a(r){var e,t=Yr(r),n=t[0],i=t[1],s=new ma(ba(r,n,i)),o=0,a=i>0?n-4:n,c;for(c=0;c<a;c+=4)e=Q[r.charCodeAt(c)]<<18|Q[r.charCodeAt(c+1)]<<12|Q[r.charCodeAt(c+2)]<<6|Q[r.charCodeAt(c+3)],s[o++]=e>>16&255,s[o++]=e>>8&255,s[o++]=e&255;return i===2&&(e=Q[r.charCodeAt(c)]<<2|Q[r.charCodeAt(c+1)]>>4,s[o++]=e&255),i===1&&(e=Q[r.charCodeAt(c)]<<10|Q[r.charCodeAt(c+1)]<<4|Q[r.charCodeAt(c+2)]>>2,s[o++]=e>>8&255,s[o++]=e&255),s}function xa(r){return ne[r>>18&63]+ne[r>>12&63]+ne[r>>6&63]+ne[r&63]}function Ba(r,e,t){for(var n,i=[],s=e;s<t;s+=3)n=(r[s]<<16&16711680)+(r[s+1]<<8&65280)+(r[s+2]&255),i.push(xa(n));return i.join("")}function va(r){for(var e,t=r.length,n=t%3,i=[],s=16383,o=0,a=t-n;o<a;o+=s)i.push(Ba(r,o,o+s>a?a:o+s));return n===1?(e=r[t-1],i.push(ne[e>>2]+ne[e<<4&63]+"==")):n===2&&(e=(r[t-2]<<8)+r[t-1],i.push(ne[e>>10]+ne[e>>4&63]+ne[e<<2&63]+"=")),i.join("")}});var tn=m(Mt=>{u();Mt.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,h=-7,p=t?i-1:0,w=t?-1:1,M=r[e+p];for(p+=w,s=M&(1<<-h)-1,M>>=-h,h+=a;h>0;s=s*256+r[e+p],p+=w,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=n;h>0;o=o*256+r[e+p],p+=w,h-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(M?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(M?-1:1)*o*Math.pow(2,s-n)};Mt.write=function(r,e,t,n,i,s){var o,a,c,l=s*8-i-1,h=(1<<l)-1,p=h>>1,w=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,M=n?0:s-1,b=n?1:-1,C=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=h):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+p>=1?e+=w/c:e+=w*Math.pow(2,1-p),e*c>=2&&(o++,c/=2),o+p>=h?(a=0,o=h):o+p>=1?(a=(e*c-1)*Math.pow(2,i),o=o+p):(a=e*Math.pow(2,p-1)*Math.pow(2,i),o=0));i>=8;r[t+M]=a&255,M+=b,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;r[t+M]=o&255,M+=b,o/=256,l-=8);r[t+M-b]|=C*128}});var ge=m(je=>{u();"use strict";var Lt=en(),Oe=tn(),rn=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;je.Buffer=f;je.SlowBuffer=Ta;je.INSPECT_MAX_BYTES=50;var at=2147483647;je.kMaxLength=at;f.TYPED_ARRAY_SUPPORT=Ea();!f.TYPED_ARRAY_SUPPORT&&typeof console!="undefined"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function Ea(){try{let r=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(r,e),r.foo()===42}catch(r){return!1}}Object.defineProperty(f.prototype,"parent",{enumerable:!0,get:function(){if(!!f.isBuffer(this))return this.buffer}});Object.defineProperty(f.prototype,"offset",{enumerable:!0,get:function(){if(!!f.isBuffer(this))return this.byteOffset}});function he(r){if(r>at)throw new RangeError('The value "'+r+'" is invalid for option "size"');let e=new Uint8Array(r);return Object.setPrototypeOf(e,f.prototype),e}function f(r,e,t){if(typeof r=="number"){if(typeof e=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return Ot(r)}return nn(r,e,t)}f.poolSize=8192;function nn(r,e,t){if(typeof r=="string")return Sa(r,e);if(ArrayBuffer.isView(r))return Ca(r);if(r==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r);if(ie(r,ArrayBuffer)||r&&ie(r.buffer,ArrayBuffer)||typeof SharedArrayBuffer!="undefined"&&(ie(r,SharedArrayBuffer)||r&&ie(r.buffer,SharedArrayBuffer)))return Pt(r,e,t);if(typeof r=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');let n=r.valueOf&&r.valueOf();if(n!=null&&n!==r)return f.from(n,e,t);let i=Aa(r);if(i)return i;if(typeof Symbol!="undefined"&&Symbol.toPrimitive!=null&&typeof r[Symbol.toPrimitive]=="function")return f.from(r[Symbol.toPrimitive]("string"),e,t);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof r)}f.from=function(r,e,t){return nn(r,e,t)};Object.setPrototypeOf(f.prototype,Uint8Array.prototype);Object.setPrototypeOf(f,Uint8Array);function sn(r){if(typeof r!="number")throw new TypeError('"size" argument must be of type number');if(r<0)throw new RangeError('The value "'+r+'" is invalid for option "size"')}function ka(r,e,t){return sn(r),r<=0?he(r):e!==void 0?typeof t=="string"?he(r).fill(e,t):he(r).fill(e):he(r)}f.alloc=function(r,e,t){return ka(r,e,t)};function Ot(r){return sn(r),he(r<0?0:jt(r)|0)}f.allocUnsafe=function(r){return Ot(r)};f.allocUnsafeSlow=function(r){return Ot(r)};function Sa(r,e){if((typeof e!="string"||e==="")&&(e="utf8"),!f.isEncoding(e))throw new TypeError("Unknown encoding: "+e);let t=on(r,e)|0,n=he(t),i=n.write(r,e);return i!==t&&(n=n.slice(0,i)),n}function It(r){let e=r.length<0?0:jt(r.length)|0,t=he(e);for(let n=0;n<e;n+=1)t[n]=r[n]&255;return t}function Ca(r){if(ie(r,Uint8Array)){let e=new Uint8Array(r);return Pt(e.buffer,e.byteOffset,e.byteLength)}return It(r)}function Pt(r,e,t){if(e<0||r.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(r.byteLength<e+(t||0))throw new RangeError('"length" is outside of buffer bounds');let n;return e===void 0&&t===void 0?n=new Uint8Array(r):t===void 0?n=new Uint8Array(r,e):n=new Uint8Array(r,e,t),Object.setPrototypeOf(n,f.prototype),n}function Aa(r){if(f.isBuffer(r)){let e=jt(r.length)|0,t=he(e);return t.length===0||r.copy(t,0,0,e),t}if(r.length!==void 0)return typeof r.length!="number"||Rt(r.length)?he(0):It(r);if(r.type==="Buffer"&&Array.isArray(r.data))return It(r.data)}function jt(r){if(r>=at)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+at.toString(16)+" bytes");return r|0}function Ta(r){return+r!=r&&(r=0),f.alloc(+r)}f.isBuffer=function(e){return e!=null&&e._isBuffer===!0&&e!==f.prototype};f.compare=function(e,t){if(ie(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),ie(t,Uint8Array)&&(t=f.from(t,t.offset,t.byteLength)),!f.isBuffer(e)||!f.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,i=t.length;for(let s=0,o=Math.min(n,i);s<o;++s)if(e[s]!==t[s]){n=e[s],i=t[s];break}return n<i?-1:i<n?1:0};f.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}};f.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(e.length===0)return f.alloc(0);let n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;let i=f.allocUnsafe(t),s=0;for(n=0;n<e.length;++n){let o=e[n];if(ie(o,Uint8Array))s+o.length>i.length?(f.isBuffer(o)||(o=f.from(o)),o.copy(i,s)):Uint8Array.prototype.set.call(i,o,s);else if(f.isBuffer(o))o.copy(i,s);else throw new TypeError('"list" argument must be an Array of Buffers');s+=o.length}return i};function on(r,e){if(f.isBuffer(r))return r.length;if(ArrayBuffer.isView(r)||ie(r,ArrayBuffer))return r.byteLength;if(typeof r!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof r);let t=r.length,n=arguments.length>2&&arguments[2]===!0;if(!n&&t===0)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return t;case"utf8":case"utf-8":return Nt(r).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return t*2;case"hex":return t>>>1;case"base64":return wn(r).length;default:if(i)return n?-1:Nt(r).length;e=(""+e).toLowerCase(),i=!0}}f.byteLength=on;function Fa(r,e,t){let n=!1;if((e===void 0||e<0)&&(e=0),e>this.length||((t===void 0||t>this.length)&&(t=this.length),t<=0)||(t>>>=0,e>>>=0,t<=e))return"";for(r||(r="utf8");;)switch(r){case"hex":return Ua(this,e,t);case"utf8":case"utf-8":return un(this,e,t);case"ascii":return Na(this,e,t);case"latin1":case"binary":return Ra(this,e,t);case"base64":return ja(this,e,t);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return za(this,e,t);default:if(n)throw new TypeError("Unknown encoding: "+r);r=(r+"").toLowerCase(),n=!0}}f.prototype._isBuffer=!0;function ve(r,e,t){let n=r[e];r[e]=r[t],r[t]=n}f.prototype.swap16=function(){let e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)ve(this,t,t+1);return this};f.prototype.swap32=function(){let e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)ve(this,t,t+3),ve(this,t+1,t+2);return this};f.prototype.swap64=function(){let e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)ve(this,t,t+7),ve(this,t+1,t+6),ve(this,t+2,t+5),ve(this,t+3,t+4);return this};f.prototype.toString=function(){let e=this.length;return e===0?"":arguments.length===0?un(this,0,e):Fa.apply(this,arguments)};f.prototype.toLocaleString=f.prototype.toString;f.prototype.equals=function(e){if(!f.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e?!0:f.compare(this,e)===0};f.prototype.inspect=function(){let e="",t=je.INSPECT_MAX_BYTES;return e=this.toString("hex",0,t).replace(/(.{2})/g,"$1 ").trim(),this.length>t&&(e+=" ... "),"<Buffer "+e+">"};rn&&(f.prototype[rn]=f.prototype.inspect);f.prototype.compare=function(e,t,n,i,s){if(ie(e,Uint8Array)&&(e=f.from(e,e.offset,e.byteLength)),!f.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(t===void 0&&(t=0),n===void 0&&(n=e?e.length:0),i===void 0&&(i=0),s===void 0&&(s=this.length),t<0||n>e.length||i<0||s>this.length)throw new RangeError("out of range index");if(i>=s&&t>=n)return 0;if(i>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,i>>>=0,s>>>=0,this===e)return 0;let o=s-i,a=n-t,c=Math.min(o,a),l=this.slice(i,s),h=e.slice(t,n);for(let p=0;p<c;++p)if(l[p]!==h[p]){o=l[p],a=h[p];break}return o<a?-1:a<o?1:0};function an(r,e,t,n,i){if(r.length===0)return-1;if(typeof t=="string"?(n=t,t=0):t>2147483647?t=2147483647:t<-2147483648&&(t=-2147483648),t=+t,Rt(t)&&(t=i?0:r.length-1),t<0&&(t=r.length+t),t>=r.length){if(i)return-1;t=r.length-1}else if(t<0)if(i)t=0;else return-1;if(typeof e=="string"&&(e=f.from(e,n)),f.isBuffer(e))return e.length===0?-1:cn(r,e,t,n,i);if(typeof e=="number")return e=e&255,typeof Uint8Array.prototype.indexOf=="function"?i?Uint8Array.prototype.indexOf.call(r,e,t):Uint8Array.prototype.lastIndexOf.call(r,e,t):cn(r,[e],t,n,i);throw new TypeError("val must be string, number or Buffer")}function cn(r,e,t,n,i){let s=1,o=r.length,a=e.length;if(n!==void 0&&(n=String(n).toLowerCase(),n==="ucs2"||n==="ucs-2"||n==="utf16le"||n==="utf-16le")){if(r.length<2||e.length<2)return-1;s=2,o/=2,a/=2,t/=2}function c(h,p){return s===1?h[p]:h.readUInt16BE(p*s)}let l;if(i){let h=-1;for(l=t;l<o;l++)if(c(r,l)===c(e,h===-1?0:l-h)){if(h===-1&&(h=l),l-h+1===a)return h*s}else h!==-1&&(l-=l-h),h=-1}else for(t+a>o&&(t=o-a),l=t;l>=0;l--){let h=!0;for(let p=0;p<a;p++)if(c(r,l+p)!==c(e,p)){h=!1;break}if(h)return l}return-1}f.prototype.includes=function(e,t,n){return this.indexOf(e,t,n)!==-1};f.prototype.indexOf=function(e,t,n){return an(this,e,t,n,!0)};f.prototype.lastIndexOf=function(e,t,n){return an(this,e,t,n,!1)};function Ma(r,e,t,n){t=Number(t)||0;let i=r.length-t;n?(n=Number(n),n>i&&(n=i)):n=i;let s=e.length;n>s/2&&(n=s/2);let o;for(o=0;o<n;++o){let a=parseInt(e.substr(o*2,2),16);if(Rt(a))return o;r[t+o]=a}return o}function La(r,e,t,n){return ct(Nt(e,r.length-t),r,t,n)}function Oa(r,e,t,n){return ct($a(e),r,t,n)}function Ia(r,e,t,n){return ct(wn(e),r,t,n)}function Pa(r,e,t,n){return ct(Ga(e,r.length-t),r,t,n)}f.prototype.write=function(e,t,n,i){if(t===void 0)i="utf8",n=this.length,t=0;else if(n===void 0&&typeof t=="string")i=t,n=this.length,t=0;else if(isFinite(t))t=t>>>0,isFinite(n)?(n=n>>>0,i===void 0&&(i="utf8")):(i=n,n=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let s=this.length-t;if((n===void 0||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");i||(i="utf8");let o=!1;for(;;)switch(i){case"hex":return Ma(this,e,t,n);case"utf8":case"utf-8":return La(this,e,t,n);case"ascii":case"latin1":case"binary":return Oa(this,e,t,n);case"base64":return Ia(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Pa(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+i);i=(""+i).toLowerCase(),o=!0}};f.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ja(r,e,t){return e===0&&t===r.length?Lt.fromByteArray(r):Lt.fromByteArray(r.slice(e,t))}function un(r,e,t){t=Math.min(r.length,t);let n=[],i=e;for(;i<t;){let s=r[i],o=null,a=s>239?4:s>223?3:s>191?2:1;if(i+a<=t){let c,l,h,p;switch(a){case 1:s<128&&(o=s);break;case 2:c=r[i+1],(c&192)==128&&(p=(s&31)<<6|c&63,p>127&&(o=p));break;case 3:c=r[i+1],l=r[i+2],(c&192)==128&&(l&192)==128&&(p=(s&15)<<12|(c&63)<<6|l&63,p>2047&&(p<55296||p>57343)&&(o=p));break;case 4:c=r[i+1],l=r[i+2],h=r[i+3],(c&192)==128&&(l&192)==128&&(h&192)==128&&(p=(s&15)<<18|(c&63)<<12|(l&63)<<6|h&63,p>65535&&p<1114112&&(o=p))}}o===null?(o=65533,a=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|o&1023),n.push(o),i+=a}return Da(n)}var ln=4096;function Da(r){let e=r.length;if(e<=ln)return String.fromCharCode.apply(String,r);let t="",n=0;for(;n<e;)t+=String.fromCharCode.apply(String,r.slice(n,n+=ln));return t}function Na(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]&127);return n}function Ra(r,e,t){let n="";t=Math.min(r.length,t);for(let i=e;i<t;++i)n+=String.fromCharCode(r[i]);return n}function Ua(r,e,t){let n=r.length;(!e||e<0)&&(e=0),(!t||t<0||t>n)&&(t=n);let i="";for(let s=e;s<t;++s)i+=Va[r[s]];return i}function za(r,e,t){let n=r.slice(e,t),i="";for(let s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+n[s+1]*256);return i}f.prototype.slice=function(e,t){let n=this.length;e=~~e,t=t===void 0?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);let i=this.subarray(e,t);return Object.setPrototypeOf(i,f.prototype),i};function j(r,e,t){if(r%1!=0||r<0)throw new RangeError("offset is not uint");if(r+e>t)throw new RangeError("Trying to access beyond buffer length")}f.prototype.readUintLE=f.prototype.readUIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||j(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return i};f.prototype.readUintBE=f.prototype.readUIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||j(e,t,this.length);let i=this[e+--t],s=1;for(;t>0&&(s*=256);)i+=this[e+--t]*s;return i};f.prototype.readUint8=f.prototype.readUInt8=function(e,t){return e=e>>>0,t||j(e,1,this.length),this[e]};f.prototype.readUint16LE=f.prototype.readUInt16LE=function(e,t){return e=e>>>0,t||j(e,2,this.length),this[e]|this[e+1]<<8};f.prototype.readUint16BE=f.prototype.readUInt16BE=function(e,t){return e=e>>>0,t||j(e,2,this.length),this[e]<<8|this[e+1]};f.prototype.readUint32LE=f.prototype.readUInt32LE=function(e,t){return e=e>>>0,t||j(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+this[e+3]*16777216};f.prototype.readUint32BE=f.prototype.readUInt32BE=function(e,t){return e=e>>>0,t||j(e,4,this.length),this[e]*16777216+(this[e+1]<<16|this[e+2]<<8|this[e+3])};f.prototype.readBigUInt64LE=ye(function(e){e=e>>>0,Pe(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ve(e,this.length-8);let i=t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24,s=this[++e]+this[++e]*2**8+this[++e]*2**16+n*2**24;return BigInt(i)+(BigInt(s)<<BigInt(32))});f.prototype.readBigUInt64BE=ye(function(e){e=e>>>0,Pe(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ve(e,this.length-8);let i=t*2**24+this[++e]*2**16+this[++e]*2**8+this[++e],s=this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n;return(BigInt(i)<<BigInt(32))+BigInt(s)});f.prototype.readIntLE=function(e,t,n){e=e>>>0,t=t>>>0,n||j(e,t,this.length);let i=this[e],s=1,o=0;for(;++o<t&&(s*=256);)i+=this[e+o]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i};f.prototype.readIntBE=function(e,t,n){e=e>>>0,t=t>>>0,n||j(e,t,this.length);let i=t,s=1,o=this[e+--i];for(;i>0&&(s*=256);)o+=this[e+--i]*s;return s*=128,o>=s&&(o-=Math.pow(2,8*t)),o};f.prototype.readInt8=function(e,t){return e=e>>>0,t||j(e,1,this.length),this[e]&128?(255-this[e]+1)*-1:this[e]};f.prototype.readInt16LE=function(e,t){e=e>>>0,t||j(e,2,this.length);let n=this[e]|this[e+1]<<8;return n&32768?n|4294901760:n};f.prototype.readInt16BE=function(e,t){e=e>>>0,t||j(e,2,this.length);let n=this[e+1]|this[e]<<8;return n&32768?n|4294901760:n};f.prototype.readInt32LE=function(e,t){return e=e>>>0,t||j(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24};f.prototype.readInt32BE=function(e,t){return e=e>>>0,t||j(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]};f.prototype.readBigInt64LE=ye(function(e){e=e>>>0,Pe(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ve(e,this.length-8);let i=this[e+4]+this[e+5]*2**8+this[e+6]*2**16+(n<<24);return(BigInt(i)<<BigInt(32))+BigInt(t+this[++e]*2**8+this[++e]*2**16+this[++e]*2**24)});f.prototype.readBigInt64BE=ye(function(e){e=e>>>0,Pe(e,"offset");let t=this[e],n=this[e+7];(t===void 0||n===void 0)&&Ve(e,this.length-8);let i=(t<<24)+this[++e]*2**16+this[++e]*2**8+this[++e];return(BigInt(i)<<BigInt(32))+BigInt(this[++e]*2**24+this[++e]*2**16+this[++e]*2**8+n)});f.prototype.readFloatLE=function(e,t){return e=e>>>0,t||j(e,4,this.length),Oe.read(this,e,!0,23,4)};f.prototype.readFloatBE=function(e,t){return e=e>>>0,t||j(e,4,this.length),Oe.read(this,e,!1,23,4)};f.prototype.readDoubleLE=function(e,t){return e=e>>>0,t||j(e,8,this.length),Oe.read(this,e,!0,52,8)};f.prototype.readDoubleBE=function(e,t){return e=e>>>0,t||j(e,8,this.length),Oe.read(this,e,!1,52,8)};function U(r,e,t,n,i,s){if(!f.isBuffer(r))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(t+n>r.length)throw new RangeError("Index out of range")}f.prototype.writeUintLE=f.prototype.writeUIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;U(this,e,t,n,a,0)}let s=1,o=0;for(this[t]=e&255;++o<n&&(s*=256);)this[t+o]=e/s&255;return t+n};f.prototype.writeUintBE=f.prototype.writeUIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,n=n>>>0,!i){let a=Math.pow(2,8*n)-1;U(this,e,t,n,a,0)}let s=n-1,o=1;for(this[t+s]=e&255;--s>=0&&(o*=256);)this[t+s]=e/o&255;return t+n};f.prototype.writeUint8=f.prototype.writeUInt8=function(e,t,n){return e=+e,t=t>>>0,n||U(this,e,t,1,255,0),this[t]=e&255,t+1};f.prototype.writeUint16LE=f.prototype.writeUInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||U(this,e,t,2,65535,0),this[t]=e&255,this[t+1]=e>>>8,t+2};f.prototype.writeUint16BE=f.prototype.writeUInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||U(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=e&255,t+2};f.prototype.writeUint32LE=f.prototype.writeUInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||U(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=e&255,t+4};f.prototype.writeUint32BE=f.prototype.writeUInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||U(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};function hn(r,e,t,n,i){mn(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s,s=s>>8,r[t++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,o=o>>8,r[t++]=o,t}function fn(r,e,t,n,i){mn(e,n,i,r,t,7);let s=Number(e&BigInt(4294967295));r[t+7]=s,s=s>>8,r[t+6]=s,s=s>>8,r[t+5]=s,s=s>>8,r[t+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return r[t+3]=o,o=o>>8,r[t+2]=o,o=o>>8,r[t+1]=o,o=o>>8,r[t]=o,t+8}f.prototype.writeBigUInt64LE=ye(function(e,t=0){return hn(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});f.prototype.writeBigUInt64BE=ye(function(e,t=0){return fn(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))});f.prototype.writeIntLE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);U(this,e,t,n,c-1,-c)}let s=0,o=1,a=0;for(this[t]=e&255;++s<n&&(o*=256);)e<0&&a===0&&this[t+s-1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};f.prototype.writeIntBE=function(e,t,n,i){if(e=+e,t=t>>>0,!i){let c=Math.pow(2,8*n-1);U(this,e,t,n,c-1,-c)}let s=n-1,o=1,a=0;for(this[t+s]=e&255;--s>=0&&(o*=256);)e<0&&a===0&&this[t+s+1]!==0&&(a=1),this[t+s]=(e/o>>0)-a&255;return t+n};f.prototype.writeInt8=function(e,t,n){return e=+e,t=t>>>0,n||U(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=e&255,t+1};f.prototype.writeInt16LE=function(e,t,n){return e=+e,t=t>>>0,n||U(this,e,t,2,32767,-32768),this[t]=e&255,this[t+1]=e>>>8,t+2};f.prototype.writeInt16BE=function(e,t,n){return e=+e,t=t>>>0,n||U(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=e&255,t+2};f.prototype.writeInt32LE=function(e,t,n){return e=+e,t=t>>>0,n||U(this,e,t,4,2147483647,-2147483648),this[t]=e&255,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4};f.prototype.writeInt32BE=function(e,t,n){return e=+e,t=t>>>0,n||U(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=e&255,t+4};f.prototype.writeBigInt64LE=ye(function(e,t=0){return hn(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});f.prototype.writeBigInt64BE=ye(function(e,t=0){return fn(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function pn(r,e,t,n,i,s){if(t+n>r.length)throw new RangeError("Index out of range");if(t<0)throw new RangeError("Index out of range")}function dn(r,e,t,n,i){return e=+e,t=t>>>0,i||pn(r,e,t,4,34028234663852886e22,-34028234663852886e22),Oe.write(r,e,t,n,23,4),t+4}f.prototype.writeFloatLE=function(e,t,n){return dn(this,e,t,!0,n)};f.prototype.writeFloatBE=function(e,t,n){return dn(this,e,t,!1,n)};function yn(r,e,t,n,i){return e=+e,t=t>>>0,i||pn(r,e,t,8,17976931348623157e292,-17976931348623157e292),Oe.write(r,e,t,n,52,8),t+8}f.prototype.writeDoubleLE=function(e,t,n){return yn(this,e,t,!0,n)};f.prototype.writeDoubleBE=function(e,t,n){return yn(this,e,t,!1,n)};f.prototype.copy=function(e,t,n,i){if(!f.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),!i&&i!==0&&(i=this.length),t>=e.length&&(t=e.length),t||(t=0),i>0&&i<n&&(i=n),i===n||e.length===0||this.length===0)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("sourceEnd out of bounds");i>this.length&&(i=this.length),e.length-t<i-n&&(i=e.length-t+n);let s=i-n;return this===e&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(t,n,i):Uint8Array.prototype.set.call(e,this.subarray(n,i),t),s};f.prototype.fill=function(e,t,n,i){if(typeof e=="string"){if(typeof t=="string"?(i=t,t=0,n=this.length):typeof n=="string"&&(i=n,n=this.length),i!==void 0&&typeof i!="string")throw new TypeError("encoding must be a string");if(typeof i=="string"&&!f.isEncoding(i))throw new TypeError("Unknown encoding: "+i);if(e.length===1){let o=e.charCodeAt(0);(i==="utf8"&&o<128||i==="latin1")&&(e=o)}}else typeof e=="number"?e=e&255:typeof e=="boolean"&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;t=t>>>0,n=n===void 0?this.length:n>>>0,e||(e=0);let s;if(typeof e=="number")for(s=t;s<n;++s)this[s]=e;else{let o=f.isBuffer(e)?e:f.from(e,i),a=o.length;if(a===0)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-t;++s)this[s+t]=o[s%a]}return this};var Ie={};function Dt(r,e,t){Ie[r]=class extends t{constructor(){super();Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${r}]`,this.stack,delete this.name}get code(){return r}set code(i){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:i,writable:!0})}toString(){return`${this.name} [${r}]: ${this.message}`}}}Dt("ERR_BUFFER_OUT_OF_BOUNDS",function(r){return r?`${r} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError);Dt("ERR_INVALID_ARG_TYPE",function(r,e){return`The "${r}" argument must be of type number. Received type ${typeof e}`},TypeError);Dt("ERR_OUT_OF_RANGE",function(r,e,t){let n=`The value of "${r}" is out of range.`,i=t;return Number.isInteger(t)&&Math.abs(t)>2**32?i=gn(String(t)):typeof t=="bigint"&&(i=String(t),(t>BigInt(2)**BigInt(32)||t<-(BigInt(2)**BigInt(32)))&&(i=gn(i)),i+="n"),n+=` It must be ${e}. Received ${i}`,n},RangeError);function gn(r){let e="",t=r.length,n=r[0]==="-"?1:0;for(;t>=n+4;t-=3)e=`_${r.slice(t-3,t)}${e}`;return`${r.slice(0,t)}${e}`}function qa(r,e,t){Pe(e,"offset"),(r[e]===void 0||r[e+t]===void 0)&&Ve(e,r.length-(t+1))}function mn(r,e,t,n,i,s){if(r>t||r<e){let o=typeof e=="bigint"?"n":"",a;throw s>3?e===0||e===BigInt(0)?a=`>= 0${o} and < 2${o} ** ${(s+1)*8}${o}`:a=`>= -(2${o} ** ${(s+1)*8-1}${o}) and < 2 ** ${(s+1)*8-1}${o}`:a=`>= ${e}${o} and <= ${t}${o}`,new Ie.ERR_OUT_OF_RANGE("value",a,r)}qa(n,i,s)}function Pe(r,e){if(typeof r!="number")throw new Ie.ERR_INVALID_ARG_TYPE(e,"number",r)}function Ve(r,e,t){throw Math.floor(r)!==r?(Pe(r,t),new Ie.ERR_OUT_OF_RANGE(t||"offset","an integer",r)):e<0?new Ie.ERR_BUFFER_OUT_OF_BOUNDS:new Ie.ERR_OUT_OF_RANGE(t||"offset",`>= ${t?1:0} and <= ${e}`,r)}var Wa=/[^+/0-9A-Za-z-_]/g;function Ha(r){if(r=r.split("=")[0],r=r.trim().replace(Wa,""),r.length<2)return"";for(;r.length%4!=0;)r=r+"=";return r}function Nt(r,e){e=e||1/0;let t,n=r.length,i=null,s=[];for(let o=0;o<n;++o){if(t=r.charCodeAt(o),t>55295&&t<57344){if(!i){if(t>56319){(e-=3)>-1&&s.push(239,191,189);continue}else if(o+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=t;continue}if(t<56320){(e-=3)>-1&&s.push(239,191,189),i=t;continue}t=(i-55296<<10|t-56320)+65536}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,t<128){if((e-=1)<0)break;s.push(t)}else if(t<2048){if((e-=2)<0)break;s.push(t>>6|192,t&63|128)}else if(t<65536){if((e-=3)<0)break;s.push(t>>12|224,t>>6&63|128,t&63|128)}else if(t<1114112){if((e-=4)<0)break;s.push(t>>18|240,t>>12&63|128,t>>6&63|128,t&63|128)}else throw new Error("Invalid code point")}return s}function $a(r){let e=[];for(let t=0;t<r.length;++t)e.push(r.charCodeAt(t)&255);return e}function Ga(r,e){let t,n,i,s=[];for(let o=0;o<r.length&&!((e-=2)<0);++o)t=r.charCodeAt(o),n=t>>8,i=t%256,s.push(i),s.push(n);return s}function wn(r){return Lt.toByteArray(Ha(r))}function ct(r,e,t,n){let i;for(i=0;i<n&&!(i+t>=e.length||i>=r.length);++i)e[i+t]=r[i];return i}function ie(r,e){return r instanceof e||r!=null&&r.constructor!=null&&r.constructor.name!=null&&r.constructor.name===e.name}function Rt(r){return r!==r}var Va=function(){let r="0123456789abcdef",e=new Array(256);for(let t=0;t<16;++t){let n=t*16;for(let i=0;i<16;++i)e[n+i]=r[t]+r[i]}return e}();function ye(r){return typeof BigInt=="undefined"?Ja:r}function Ja(){throw new Error("BigInt not supported")}});var vn=m((Ol,Bn)=>{u();var L=Bn.exports={},se,oe;function Ut(){throw new Error("setTimeout has not been defined")}function zt(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?se=setTimeout:se=Ut}catch(r){se=Ut}try{typeof clearTimeout=="function"?oe=clearTimeout:oe=zt}catch(r){oe=zt}})();function bn(r){if(se===setTimeout)return setTimeout(r,0);if((se===Ut||!se)&&setTimeout)return se=setTimeout,setTimeout(r,0);try{return se(r,0)}catch(e){try{return se.call(null,r,0)}catch(t){return se.call(this,r,0)}}}function Qa(r){if(oe===clearTimeout)return clearTimeout(r);if((oe===zt||!oe)&&clearTimeout)return oe=clearTimeout,clearTimeout(r);try{return oe(r)}catch(e){try{return oe.call(null,r)}catch(t){return oe.call(this,r)}}}var fe=[],De=!1,Ee,ut=-1;function Xa(){!De||!Ee||(De=!1,Ee.length?fe=Ee.concat(fe):ut=-1,fe.length&&_n())}function _n(){if(!De){var r=bn(Xa);De=!0;for(var e=fe.length;e;){for(Ee=fe,fe=[];++ut<e;)Ee&&Ee[ut].run();ut=-1,e=fe.length}Ee=null,De=!1,Qa(r)}}L.nextTick=function(r){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];fe.push(new xn(r,e)),fe.length===1&&!De&&bn(_n)};function xn(r,e){this.fun=r,this.array=e}xn.prototype.run=function(){this.fun.apply(null,this.array)};L.title="browser";L.browser=!0;L.env={};L.argv=[];L.version="";L.versions={};function pe(){}L.on=pe;L.addListener=pe;L.once=pe;L.off=pe;L.removeListener=pe;L.removeAllListeners=pe;L.emit=pe;L.prependListener=pe;L.prependOnceListener=pe;L.listeners=function(r){return[]};L.binding=function(r){throw new Error("process.binding is not supported")};L.cwd=function(){return"/"};L.chdir=function(r){throw new Error("process.chdir is not supported")};L.umask=function(){return 0}});var y,d,u=ya(()=>{y=T(ge()),d=T(vn())});var Qn=m((eh,Jn)=>{u();Jn.exports=Vn;var Gn=128,Dc=127,Nc=~Dc,Rc=Math.pow(2,31);function Vn(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Rc;)e[t++]=r&255|Gn,r/=128;for(;r&Nc;)e[t++]=r&255|Gn,r>>>=7;return e[t]=r|0,Vn.bytes=t-n+1,e}});var Zn=m((th,Kn)=>{u();Kn.exports=Vt;var Uc=128,Xn=127;function Vt(r,e){var t=0,e=e||0,n=0,i=e,s,o=r.length;do{if(i>=o)throw Vt.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=n<28?(s&Xn)<<n:(s&Xn)*Math.pow(2,n),n+=7}while(s>=Uc);return Vt.bytes=i-e,t}});var ei=m((rh,Yn)=>{u();var zc=Math.pow(2,7),qc=Math.pow(2,14),Wc=Math.pow(2,21),Hc=Math.pow(2,28),$c=Math.pow(2,35),Gc=Math.pow(2,42),Vc=Math.pow(2,49),Jc=Math.pow(2,56),Qc=Math.pow(2,63);Yn.exports=function(r){return r<zc?1:r<qc?2:r<Wc?3:r<Hc?4:r<$c?5:r<Gc?6:r<Vc?7:r<Jc?8:r<Qc?9:10}});var ri=m((nh,ti)=>{u();ti.exports={encode:Qn(),decode:Zn(),encodingLength:ei()}});var si=m((ih,ii)=>{u();"use strict";var ni=ri();ii.exports=r=>{if(!(r instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");let e=[];for(;r.length>0;){let t=ni.decode(r);e.push(t),r=r.slice(ni.decode.bytes)}return e}});var ci=m((sh,ai)=>{u();ai.exports=Jt;var oi=128,Xc=127,Kc=~Xc,Zc=Math.pow(2,31);function Jt(r,e,t){if(Number.MAX_SAFE_INTEGER&&r>Number.MAX_SAFE_INTEGER)throw Jt.bytes=0,new RangeError("Could not encode varint");e=e||[],t=t||0;for(var n=t;r>=Zc;)e[t++]=r&255|oi,r/=128;for(;r&Kc;)e[t++]=r&255|oi,r>>>=7;return e[t]=r|0,Jt.bytes=t-n+1,e}});var hi=m((oh,li)=>{u();li.exports=Qt;var Yc=128,ui=127;function Qt(r,e){var t=0,e=e||0,n=0,i=e,s,o=r.length;do{if(i>=o||n>49)throw Qt.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=n<28?(s&ui)<<n:(s&ui)*Math.pow(2,n),n+=7}while(s>=Yc);return Qt.bytes=i-e,t}});var pi=m((ah,fi)=>{u();var eu=Math.pow(2,7),tu=Math.pow(2,14),ru=Math.pow(2,21),nu=Math.pow(2,28),iu=Math.pow(2,35),su=Math.pow(2,42),ou=Math.pow(2,49),au=Math.pow(2,56),cu=Math.pow(2,63);fi.exports=function(r){return r<eu?1:r<tu?2:r<ru?3:r<nu?4:r<iu?5:r<su?6:r<ou?7:r<au?8:r<cu?9:10}});var pt=m((ch,di)=>{u();di.exports={encode:ci(),decode:hi(),encodingLength:pi()}});var mi=m((lh,gi)=>{u();var ze=1e3,qe=ze*60,We=qe*60,Se=We*24,lu=Se*7,hu=Se*365.25;gi.exports=function(r,e){e=e||{};var t=typeof r;if(t==="string"&&r.length>0)return fu(r);if(t==="number"&&isFinite(r))return e.long?du(r):pu(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function fu(r){if(r=String(r),!(r.length>100)){var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!!e){var t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*hu;case"weeks":case"week":case"w":return t*lu;case"days":case"day":case"d":return t*Se;case"hours":case"hour":case"hrs":case"hr":case"h":return t*We;case"minutes":case"minute":case"mins":case"min":case"m":return t*qe;case"seconds":case"second":case"secs":case"sec":case"s":return t*ze;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:return}}}}function pu(r){var e=Math.abs(r);return e>=Se?Math.round(r/Se)+"d":e>=We?Math.round(r/We)+"h":e>=qe?Math.round(r/qe)+"m":e>=ze?Math.round(r/ze)+"s":r+"ms"}function du(r){var e=Math.abs(r);return e>=Se?dt(r,e,Se,"day"):e>=We?dt(r,e,We,"hour"):e>=qe?dt(r,e,qe,"minute"):e>=ze?dt(r,e,ze,"second"):r+" ms"}function dt(r,e,t,n){var i=e>=t*1.5;return Math.round(r/t)+" "+n+(i?"s":"")}});var bi=m((hh,wi)=>{u();function yu(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=mi(),t.destroy=l,Object.keys(r).forEach(h=>{t[h]=r[h]}),t.names=[],t.skips=[],t.formatters={};function e(h){let p=0;for(let w=0;w<h.length;w++)p=(p<<5)-p+h.charCodeAt(w),p|=0;return t.colors[Math.abs(p)%t.colors.length]}t.selectColor=e;function t(h){let p,w=null,M,b;function C(...I){if(!C.enabled)return;let P=C,R=Number(new Date),$=R-(p||R);P.diff=$,P.prev=p,P.curr=R,p=R,I[0]=t.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let N=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(G,q)=>{if(G==="%%")return"%";N++;let V=t.formatters[q];if(typeof V=="function"){let Le=I[N];G=V.call(P,Le),I.splice(N,1),N--}return G}),t.formatArgs.call(P,I),(P.log||t.log).apply(P,I)}return C.namespace=h,C.useColors=t.useColors(),C.color=t.selectColor(h),C.extend=n,C.destroy=t.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>w!==null?w:(M!==t.namespaces&&(M=t.namespaces,b=t.enabled(h)),b),set:I=>{w=I}}),typeof t.init=="function"&&t.init(C),C}function n(h,p){let w=t(this.namespace+(typeof p=="undefined"?":":p)+h);return w.log=this.log,w}function i(h){t.save(h),t.namespaces=h,t.names=[],t.skips=[];let p,w=(typeof h=="string"?h:"").split(/[\s,]+/),M=w.length;for(p=0;p<M;p++)!w[p]||(h=w[p].replace(/\*/g,".*?"),h[0]==="-"?t.skips.push(new RegExp("^"+h.substr(1)+"$")):t.names.push(new RegExp("^"+h+"$")))}function s(){let h=[...t.names.map(a),...t.skips.map(a).map(p=>"-"+p)].join(",");return t.enable(""),h}function o(h){if(h[h.length-1]==="*")return!0;let p,w;for(p=0,w=t.skips.length;p<w;p++)if(t.skips[p].test(h))return!1;for(p=0,w=t.names.length;p<w;p++)if(t.names[p].test(h))return!0;return!1}function a(h){return h.toString().substring(2,h.toString().length-2).replace(/\.\*\?$/,"*")}function c(h){return h instanceof Error?h.stack||h.message:h}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}wi.exports=yu});var Xt=m((W,yt)=>{u();W.formatArgs=mu;W.save=wu;W.load=bu;W.useColors=gu;W.storage=_u();W.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();W.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function gu(){return typeof window!="undefined"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document!="undefined"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window!="undefined"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator!="undefined"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function mu(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+yt.exports.humanize(this.diff),!this.useColors)return;let e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}W.log=console.debug||console.log||(()=>{});function wu(r){try{r?W.storage.setItem("debug",r):W.storage.removeItem("debug")}catch(e){}}function bu(){let r;try{r=W.storage.getItem("debug")}catch(e){}return!r&&typeof d.default!="undefined"&&"env"in d.default&&(r=d.default.env.DEBUG),r}function _u(){try{return localStorage}catch(r){}}yt.exports=bi()(W);var{formatters:xu}=yt.exports;xu.j=function(r){try{return JSON.stringify(r)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}});var Bi=m((yh,xi)=>{u();"use strict";xi.exports=Bu;function Bu(r,e){for(var t=new Array(arguments.length-1),n=0,i=2,s=!0;i<arguments.length;)t[n++]=arguments[i++];return new Promise(function(a,c){t[n]=function(h){if(s)if(s=!1,h)c(h);else{for(var p=new Array(arguments.length-1),w=0;w<p.length;)p[w++]=arguments[w];a.apply(null,p)}};try{r.apply(e||null,t)}catch(l){s&&(s=!1,c(l))}})}});var Si=m(ki=>{u();"use strict";var mt=ki;mt.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&e.charAt(t)==="=";)++n;return Math.ceil(e.length*3)/4-n};var He=new Array(64),vi=new Array(123);for(Y=0;Y<64;)vi[He[Y]=Y<26?Y+65:Y<52?Y+71:Y<62?Y-4:Y-59|43]=Y++;var Y;mt.encode=function(e,t,n){for(var i=null,s=[],o=0,a=0,c;t<n;){var l=e[t++];switch(a){case 0:s[o++]=He[l>>2],c=(l&3)<<4,a=1;break;case 1:s[o++]=He[c|l>>4],c=(l&15)<<2,a=2;break;case 2:s[o++]=He[c|l>>6],s[o++]=He[l&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=He[c],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var Ei="invalid encoding";mt.decode=function(e,t,n){for(var i=n,s=0,o,a=0;a<e.length;){var c=e.charCodeAt(a++);if(c===61&&s>1)break;if((c=vi[c])===void 0)throw Error(Ei);switch(s){case 0:o=c,s=1;break;case 1:t[n++]=o<<2|(c&48)>>4,o=c,s=2;break;case 2:t[n++]=(o&15)<<4|(c&60)>>2,o=c,s=3;break;case 3:t[n++]=(o&3)<<6|c,s=0;break}}if(s===1)throw Error(Ei);return n-i};mt.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var Ai=m((mh,Ci)=>{u();"use strict";Ci.exports=wt;function wt(){this._listeners={}}wt.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this};wt.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var n=this._listeners[e],i=0;i<n.length;)n[i].fn===t?n.splice(i,1):++i;return this};wt.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],i=1;i<arguments.length;)n.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,n)}return this}});var Pi=m((wh,Ii)=>{u();"use strict";Ii.exports=Ti(Ti);function Ti(r){return typeof Float32Array!="undefined"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),n=t[3]===128;function i(c,l,h){e[0]=c,l[h]=t[0],l[h+1]=t[1],l[h+2]=t[2],l[h+3]=t[3]}function s(c,l,h){e[0]=c,l[h]=t[3],l[h+1]=t[2],l[h+2]=t[1],l[h+3]=t[0]}r.writeFloatLE=n?i:s,r.writeFloatBE=n?s:i;function o(c,l){return t[0]=c[l],t[1]=c[l+1],t[2]=c[l+2],t[3]=c[l+3],e[0]}function a(c,l){return t[3]=c[l],t[2]=c[l+1],t[1]=c[l+2],t[0]=c[l+3],e[0]}r.readFloatLE=n?o:a,r.readFloatBE=n?a:o}():function(){function e(n,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)n(1/i>0?0:2147483648,s,o);else if(isNaN(i))n(2143289344,s,o);else if(i>34028234663852886e22)n((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)n((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var c=Math.floor(Math.log(i)/Math.LN2),l=Math.round(i*Math.pow(2,-c)*8388608)&8388607;n((a<<31|c+127<<23|l)>>>0,s,o)}}r.writeFloatLE=e.bind(null,Fi),r.writeFloatBE=e.bind(null,Mi);function t(n,i,s){var o=n(i,s),a=(o>>31)*2+1,c=o>>>23&255,l=o&8388607;return c===255?l?NaN:a*(1/0):c===0?a*1401298464324817e-60*l:a*Math.pow(2,c-150)*(l+8388608)}r.readFloatLE=t.bind(null,Li),r.readFloatBE=t.bind(null,Oi)}(),typeof Float64Array!="undefined"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),n=t[7]===128;function i(c,l,h){e[0]=c,l[h]=t[0],l[h+1]=t[1],l[h+2]=t[2],l[h+3]=t[3],l[h+4]=t[4],l[h+5]=t[5],l[h+6]=t[6],l[h+7]=t[7]}function s(c,l,h){e[0]=c,l[h]=t[7],l[h+1]=t[6],l[h+2]=t[5],l[h+3]=t[4],l[h+4]=t[3],l[h+5]=t[2],l[h+6]=t[1],l[h+7]=t[0]}r.writeDoubleLE=n?i:s,r.writeDoubleBE=n?s:i;function o(c,l){return t[0]=c[l],t[1]=c[l+1],t[2]=c[l+2],t[3]=c[l+3],t[4]=c[l+4],t[5]=c[l+5],t[6]=c[l+6],t[7]=c[l+7],e[0]}function a(c,l){return t[7]=c[l],t[6]=c[l+1],t[5]=c[l+2],t[4]=c[l+3],t[3]=c[l+4],t[2]=c[l+5],t[1]=c[l+6],t[0]=c[l+7],e[0]}r.readDoubleLE=n?o:a,r.readDoubleBE=n?a:o}():function(){function e(n,i,s,o,a,c){var l=o<0?1:0;if(l&&(o=-o),o===0)n(0,a,c+i),n(1/o>0?0:2147483648,a,c+s);else if(isNaN(o))n(0,a,c+i),n(2146959360,a,c+s);else if(o>17976931348623157e292)n(0,a,c+i),n((l<<31|2146435072)>>>0,a,c+s);else{var h;if(o<22250738585072014e-324)h=o/5e-324,n(h>>>0,a,c+i),n((l<<31|h/4294967296)>>>0,a,c+s);else{var p=Math.floor(Math.log(o)/Math.LN2);p===1024&&(p=1023),h=o*Math.pow(2,-p),n(h*4503599627370496>>>0,a,c+i),n((l<<31|p+1023<<20|h*1048576&1048575)>>>0,a,c+s)}}}r.writeDoubleLE=e.bind(null,Fi,0,4),r.writeDoubleBE=e.bind(null,Mi,4,0);function t(n,i,s,o,a){var c=n(o,a+i),l=n(o,a+s),h=(l>>31)*2+1,p=l>>>20&2047,w=4294967296*(l&1048575)+c;return p===2047?w?NaN:h*(1/0):p===0?h*5e-324*w:h*Math.pow(2,p-1075)*(w+4503599627370496)}r.readDoubleLE=t.bind(null,Li,0,4),r.readDoubleBE=t.bind(null,Oi,4,0)}(),r}function Fi(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function Mi(r,e,t){e[t]=r>>>24,e[t+1]=r>>>16&255,e[t+2]=r>>>8&255,e[t+3]=r&255}function Li(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24)>>>0}function Oi(r,e){return(r[e]<<24|r[e+1]<<16|r[e+2]<<8|r[e+3])>>>0}});var ji=m((exports,module)=>{u();"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(r){}return null}});var Ni=m(Di=>{u();"use strict";var Kt=Di;Kt.length=function(e){for(var t=0,n=0,i=0;i<e.length;++i)n=e.charCodeAt(i),n<128?t+=1:n<2048?t+=2:(n&64512)==55296&&(e.charCodeAt(i+1)&64512)==56320?(++i,t+=4):t+=3;return t};Kt.read=function(e,t,n){var i=n-t;if(i<1)return"";for(var s=null,o=[],a=0,c;t<n;)c=e[t++],c<128?o[a++]=c:c>191&&c<224?o[a++]=(c&31)<<6|e[t++]&63:c>239&&c<365?(c=((c&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(c>>10),o[a++]=56320+(c&1023)):o[a++]=(c&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Kt.write=function(e,t,n){for(var i=n,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=s&63|128):(s&64512)==55296&&((o=e.charCodeAt(a+1))&64512)==56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=s&63|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=s&63|128);return n-i}});var Ui=m((_h,Ri)=>{u();"use strict";Ri.exports=vu;function vu(r,e,t){var n=t||8192,i=n>>>1,s=null,o=n;return function(c){if(c<1||c>i)return r(c);o+c>n&&(s=r(n),o=0);var l=e.call(s,o,o+=c);return o&7&&(o=(o|7)+1),l}}});var qi=m((xh,zi)=>{u();"use strict";zi.exports=D;var et=be();function D(r,e){this.lo=r>>>0,this.hi=e>>>0}var Ce=D.zero=new D(0,0);Ce.toNumber=function(){return 0};Ce.zzEncode=Ce.zzDecode=function(){return this};Ce.length=function(){return 1};var Eu=D.zeroHash="\0\0\0\0\0\0\0\0";D.fromNumber=function(e){if(e===0)return Ce;var t=e<0;t&&(e=-e);var n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new D(n,i)};D.from=function(e){if(typeof e=="number")return D.fromNumber(e);if(et.isString(e))if(et.Long)e=et.Long.fromString(e);else return D.fromNumber(parseInt(e,10));return e.low||e.high?new D(e.low>>>0,e.high>>>0):Ce};D.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296};D.prototype.toLong=function(e){return et.Long?new et.Long(this.lo|0,this.hi|0,Boolean(e)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(e)}};var we=String.prototype.charCodeAt;D.fromHash=function(e){return e===Eu?Ce:new D((we.call(e,0)|we.call(e,1)<<8|we.call(e,2)<<16|we.call(e,3)<<24)>>>0,(we.call(e,4)|we.call(e,5)<<8|we.call(e,6)<<16|we.call(e,7)<<24)>>>0)};D.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};D.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};D.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};D.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}});var be=m(Zt=>{u();"use strict";var g=Zt;g.asPromise=Bi();g.base64=Si();g.EventEmitter=Ai();g.float=Pi();g.inquire=ji();g.utf8=Ni();g.pool=Ui();g.LongBits=qi();g.isNode=Boolean(typeof globalThis!="undefined"&&globalThis&&globalThis.process&&globalThis.process.versions&&globalThis.process.versions.node);g.global=g.isNode&&globalThis||typeof window!="undefined"&&window||typeof self!="undefined"&&self||Zt;g.emptyArray=Object.freeze?Object.freeze([]):[];g.emptyObject=Object.freeze?Object.freeze({}):{};g.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};g.isString=function(e){return typeof e=="string"||e instanceof String};g.isObject=function(e){return e&&typeof e=="object"};g.isset=g.isSet=function(e,t){var n=e[t];return n!=null&&e.hasOwnProperty(t)?typeof n!="object"||(Array.isArray(n)?n.length:Object.keys(n).length)>0:!1};g.Buffer=function(){try{var r=g.inquire("buffer").Buffer;return r.prototype.utf8Write?r:null}catch(e){return null}}();g._Buffer_from=null;g._Buffer_allocUnsafe=null;g.newBuffer=function(e){return typeof e=="number"?g.Buffer?g._Buffer_allocUnsafe(e):new g.Array(e):g.Buffer?g._Buffer_from(e):typeof Uint8Array=="undefined"?e:new Uint8Array(e)};g.Array=typeof Uint8Array!="undefined"?Uint8Array:Array;g.Long=g.global.dcodeIO&&g.global.dcodeIO.Long||g.global.Long||g.inquire("long");g.key2Re=/^true|false|0|1$/;g.key32Re=/^-?(?:0|[1-9][0-9]*)$/;g.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;g.longToHash=function(e){return e?g.LongBits.from(e).toHash():g.LongBits.zeroHash};g.longFromHash=function(e,t){var n=g.LongBits.fromHash(e);return g.Long?g.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))};function Wi(r,e,t){for(var n=Object.keys(e),i=0;i<n.length;++i)(r[n[i]]===void 0||!t)&&(r[n[i]]=e[n[i]]);return r}g.merge=Wi;g.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function Hi(r){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),n&&Wi(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return r}}),e.prototype.toString=function(){return this.name+": "+this.message},e}g.newError=Hi;g.ProtocolError=Hi("ProtocolError");g.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};g.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}};g.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};g._configure=function(){var r=g.Buffer;if(!r){g._Buffer_from=g._Buffer_allocUnsafe=null;return}g._Buffer_from=r.from!==Uint8Array.from&&r.from||function(t,n){return new r(t,n)},g._Buffer_allocUnsafe=r.allocUnsafe||function(t){return new r(t)}}});var sr=m((vh,Ji)=>{u();"use strict";Ji.exports=x;var X=be(),Yt,bt=X.LongBits,$i=X.base64,Gi=X.utf8;function tt(r,e,t){this.fn=r,this.len=e,this.next=void 0,this.val=t}function er(){}function ku(r){this.head=r.head,this.tail=r.tail,this.len=r.len,this.next=r.states}function x(){this.len=0,this.head=new tt(er,0,0),this.tail=this.head,this.states=null}var Vi=function(){return X.Buffer?function(){return(x.create=function(){return new Yt})()}:function(){return new x}};x.create=Vi();x.alloc=function(e){return new X.Array(e)};X.Array!==Array&&(x.alloc=X.pool(x.alloc,X.Array.prototype.subarray));x.prototype._push=function(e,t,n){return this.tail=this.tail.next=new tt(e,t,n),this.len+=t,this};function tr(r,e,t){e[t]=r&255}function Su(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}function rr(r,e){this.len=r,this.next=void 0,this.val=e}rr.prototype=Object.create(tt.prototype);rr.prototype.fn=Su;x.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new rr((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};x.prototype.int32=function(e){return e<0?this._push(nr,10,bt.fromNumber(e)):this.uint32(e)};x.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function nr(r,e,t){for(;r.hi;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}x.prototype.uint64=function(e){var t=bt.from(e);return this._push(nr,t.length(),t)};x.prototype.int64=x.prototype.uint64;x.prototype.sint64=function(e){var t=bt.from(e).zzEncode();return this._push(nr,t.length(),t)};x.prototype.bool=function(e){return this._push(tr,1,e?1:0)};function ir(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}x.prototype.fixed32=function(e){return this._push(ir,4,e>>>0)};x.prototype.sfixed32=x.prototype.fixed32;x.prototype.fixed64=function(e){var t=bt.from(e);return this._push(ir,4,t.lo)._push(ir,4,t.hi)};x.prototype.sfixed64=x.prototype.fixed64;x.prototype.float=function(e){return this._push(X.float.writeFloatLE,4,e)};x.prototype.double=function(e){return this._push(X.float.writeDoubleLE,8,e)};var Cu=X.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var i=0;i<e.length;++i)t[n+i]=e[i]};x.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(tr,1,0);if(X.isString(e)){var n=x.alloc(t=$i.length(e));$i.decode(e,n,0),e=n}return this.uint32(t)._push(Cu,t,e)};x.prototype.string=function(e){var t=Gi.length(e);return t?this.uint32(t)._push(Gi.write,t,e):this._push(tr,1,0)};x.prototype.fork=function(){return this.states=new ku(this),this.head=this.tail=new tt(er,0,0),this.len=0,this};x.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new tt(er,0,0),this.len=0),this};x.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this};x.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t};x._configure=function(r){Yt=r,x.create=Vi(),Yt._configure()}});var Ki=m((Eh,Xi)=>{u();"use strict";Xi.exports=ae;var Qi=sr();(ae.prototype=Object.create(Qi.prototype)).constructor=ae;var _e=be();function ae(){Qi.call(this)}ae._configure=function(){ae.alloc=_e._Buffer_allocUnsafe,ae.writeBytesBuffer=_e.Buffer&&_e.Buffer.prototype instanceof Uint8Array&&_e.Buffer.prototype.set.name==="set"?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var i=0;i<e.length;)t[n++]=e[i++]}};ae.prototype.bytes=function(e){_e.isString(e)&&(e=_e._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(ae.writeBytesBuffer,t,e),this};function Au(r,e,t){r.length<40?_e.utf8.write(r,e,t):e.utf8Write?e.utf8Write(r,t):e.write(r,t)}ae.prototype.string=function(e){var t=_e.Buffer.byteLength(e);return this.uint32(t),t&&this._push(Au,t,e),this};ae._configure()});var cr=m((kh,rs)=>{u();"use strict";rs.exports=O;var ce=be(),or,Zi=ce.LongBits,Tu=ce.utf8;function ee(r,e){return RangeError("index out of range: "+r.pos+" + "+(e||1)+" > "+r.len)}function O(r){this.buf=r,this.pos=0,this.len=r.length}var Yi=typeof Uint8Array!="undefined"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new O(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new O(e);throw Error("illegal buffer")},es=function(){return ce.Buffer?function(t){return(O.create=function(i){return ce.Buffer.isBuffer(i)?new or(i):Yi(i)})(t)}:Yi};O.create=es();O.prototype._slice=ce.Array.prototype.subarray||ce.Array.prototype.slice;O.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,ee(this,10);return e}}();O.prototype.int32=function(){return this.uint32()|0};O.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function ar(){var r=new Zi(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r;if(r.lo=(r.lo|(this.buf[this.pos]&127)<<28)>>>0,r.hi=(r.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return r;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw ee(this);if(r.lo=(r.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return r}return r.lo=(r.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,r}if(this.len-this.pos>4){for(;e<5;++e)if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}else for(;e<5;++e){if(this.pos>=this.len)throw ee(this);if(r.hi=(r.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return r}throw Error("invalid varint encoding")}O.prototype.bool=function(){return this.uint32()!==0};function _t(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}O.prototype.fixed32=function(){if(this.pos+4>this.len)throw ee(this,4);return _t(this.buf,this.pos+=4)};O.prototype.sfixed32=function(){if(this.pos+4>this.len)throw ee(this,4);return _t(this.buf,this.pos+=4)|0};function ts(){if(this.pos+8>this.len)throw ee(this,8);return new Zi(_t(this.buf,this.pos+=4),_t(this.buf,this.pos+=4))}O.prototype.float=function(){if(this.pos+4>this.len)throw ee(this,4);var e=ce.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};O.prototype.double=function(){if(this.pos+8>this.len)throw ee(this,4);var e=ce.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};O.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw ee(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)};O.prototype.string=function(){var e=this.bytes();return Tu.read(e,0,e.length)};O.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw ee(this,e);this.pos+=e}else do if(this.pos>=this.len)throw ee(this);while(this.buf[this.pos++]&128);return this};O.prototype.skipType=function(r){switch(r){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(r=this.uint32()&7)!=4;)this.skipType(r);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+r+" at offset "+this.pos)}return this};O._configure=function(r){or=r,O.create=es(),or._configure();var e=ce.Long?"toLong":"toNumber";ce.merge(O.prototype,{int64:function(){return ar.call(this)[e](!1)},uint64:function(){return ar.call(this)[e](!0)},sint64:function(){return ar.call(this).zzDecode()[e](!1)},fixed64:function(){return ts.call(this)[e](!0)},sfixed64:function(){return ts.call(this)[e](!1)}})}});var os=m((Sh,ss)=>{u();"use strict";ss.exports=Ae;var ns=cr();(Ae.prototype=Object.create(ns.prototype)).constructor=Ae;var is=be();function Ae(r){ns.call(this,r)}Ae._configure=function(){is.Buffer&&(Ae.prototype._slice=is.Buffer.prototype.slice)};Ae.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};Ae._configure()});var cs=m((Ch,as)=>{u();"use strict";as.exports=rt;var ur=be();(rt.prototype=Object.create(ur.EventEmitter.prototype)).constructor=rt;function rt(r,e,t){if(typeof r!="function")throw TypeError("rpcImpl must be a function");ur.EventEmitter.call(this),this.rpcImpl=r,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(t)}rt.prototype.rpcCall=function r(e,t,n,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return ur.asPromise(r,o,e,t,n,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(c,l){if(c)return o.emit("error",c,e),s(c);if(l===null){o.end(!0);return}if(!(l instanceof n))try{l=n[o.responseDelimited?"decodeDelimited":"decode"](l)}catch(h){return o.emit("error",h,e),s(h)}return o.emit("data",l,e),s(null,l)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};rt.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var ls=m(us=>{u();"use strict";var Fu=us;Fu.Service=cs()});var fs=m((Th,hs)=>{u();"use strict";hs.exports={}});var ys=m(ds=>{u();"use strict";var z=ds;z.build="minimal";z.Writer=sr();z.BufferWriter=Ki();z.Reader=cr();z.BufferReader=os();z.util=be();z.rpc=ls();z.roots=fs();z.configure=ps;function ps(){z.util._configure(),z.Writer._configure(z.BufferWriter),z.Reader._configure(z.BufferReader)}ps()});var ms=m((Mh,gs)=>{u();"use strict";gs.exports=ys()});var it=m((Oh,bs)=>{u();"use strict";var ws=class extends Map{constructor(e){super();let{system:t,component:n,metric:i,metrics:s}=e;this._system=t,this._component=n,this._metric=i,this._metrics=s,this._metrics.updateComponentMetric({system:this._system,component:this._component,metric:this._metric,value:this.size})}set(e,t){return super.set(e,t),this._metrics.updateComponentMetric({system:this._system,component:this._component,metric:this._metric,value:this.size}),this}delete(e){let t=super.delete(e);return this._metrics.updateComponentMetric({system:this._system,component:this._component,metric:this._metric,value:this.size}),t}clear(){super.clear(),this._metrics.updateComponentMetric({system:this._system,component:this._component,metric:this._metric,value:this.size})}};bs.exports=({system:r="libp2p",component:e,metric:t,metrics:n})=>{let i;return n?i=new ws({system:r,component:e,metric:t,metrics:n}):i=new Map,i}});var Es=m((Hh,vs)=>{u();"use strict";function Bs(r,e){for(let t in e)Object.defineProperty(r,t,{value:e[t],enumerable:!0,configurable:!0});return r}function Ou(r,e,t){if(!r||typeof r=="string")throw new TypeError("Please pass an Error to err-code");t||(t={}),typeof e=="object"&&(t=e,e=""),e&&(t.code=e);try{return Bs(r,t)}catch(n){t.message=r.message,t.stack=r.stack;let i=function(){};return i.prototype=Object.create(Object.getPrototypeOf(r)),Bs(new i,t)}}vs.exports=Ou});var Os=m((rf,Ls)=>{u();Ls.exports=Iu;function Iu(r,e,t){var n=null,i=null,s=function(){n&&(clearTimeout(n),i=null,n=null)},o=function(){var c=i;s(),c&&c()},a=function(){if(!e)return r.apply(this,arguments);var c=this,l=arguments,h=t&&!n;if(s(),i=function(){r.apply(c,l)},n=setTimeout(function(){if(n=null,!h){var p=i;return i=null,p()}},e),h)return i()};return a.cancel=s,a.flush=o,a}});var dr=m((yf,Ds)=>{u();"use strict";var{Buffer:re}=ge(),js=Symbol.for("BufferList");function A(r){if(!(this instanceof A))return new A(r);A._init.call(this,r)}A._init=function(e){Object.defineProperty(this,js,{value:!0}),this._bufs=[],this.length=0,e&&this.append(e)};A.prototype._new=function(e){return new A(e)};A.prototype._offset=function(e){if(e===0)return[0,0];let t=0;for(let n=0;n<this._bufs.length;n++){let i=t+this._bufs[n].length;if(e<i||n===this._bufs.length-1)return[n,e-t];t=i}};A.prototype._reverseOffset=function(r){let e=r[0],t=r[1];for(let n=0;n<e;n++)t+=this._bufs[n].length;return t};A.prototype.get=function(e){if(e>this.length||e<0)return;let t=this._offset(e);return this._bufs[t[0]][t[1]]};A.prototype.slice=function(e,t){return typeof e=="number"&&e<0&&(e+=this.length),typeof t=="number"&&t<0&&(t+=this.length),this.copy(null,0,e,t)};A.prototype.copy=function(e,t,n,i){if((typeof n!="number"||n<0)&&(n=0),(typeof i!="number"||i>this.length)&&(i=this.length),n>=this.length||i<=0)return e||re.alloc(0);let s=!!e,o=this._offset(n),a=i-n,c=a,l=s&&t||0,h=o[1];if(n===0&&i===this.length){if(!s)return this._bufs.length===1?this._bufs[0]:re.concat(this._bufs,this.length);for(let p=0;p<this._bufs.length;p++)this._bufs[p].copy(e,l),l+=this._bufs[p].length;return e}if(c<=this._bufs[o[0]].length-h)return s?this._bufs[o[0]].copy(e,t,h,h+c):this._bufs[o[0]].slice(h,h+c);s||(e=re.allocUnsafe(a));for(let p=o[0];p<this._bufs.length;p++){let w=this._bufs[p].length-h;if(c>w)this._bufs[p].copy(e,l,h),l+=w;else{this._bufs[p].copy(e,l,h,h+c),l+=w;break}c-=w,h&&(h=0)}return e.length>l?e.slice(0,l):e};A.prototype.shallowSlice=function(e,t){if(e=e||0,t=typeof t!="number"?this.length:t,e<0&&(e+=this.length),t<0&&(t+=this.length),e===t)return this._new();let n=this._offset(e),i=this._offset(t),s=this._bufs.slice(n[0],i[0]+1);return i[1]===0?s.pop():s[s.length-1]=s[s.length-1].slice(0,i[1]),n[1]!==0&&(s[0]=s[0].slice(n[1])),this._new(s)};A.prototype.toString=function(e,t,n){return this.slice(t,n).toString(e)};A.prototype.consume=function(e){if(e=Math.trunc(e),Number.isNaN(e)||e<=0)return this;for(;this._bufs.length;)if(e>=this._bufs[0].length)e-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift();else{this._bufs[0]=this._bufs[0].slice(e),this.length-=e;break}return this};A.prototype.duplicate=function(){let e=this._new();for(let t=0;t<this._bufs.length;t++)e.append(this._bufs[t]);return e};A.prototype.append=function(e){if(e==null)return this;if(e.buffer)this._appendBuffer(re.from(e.buffer,e.byteOffset,e.byteLength));else if(Array.isArray(e))for(let t=0;t<e.length;t++)this.append(e[t]);else if(this._isBufferList(e))for(let t=0;t<e._bufs.length;t++)this.append(e._bufs[t]);else typeof e=="number"&&(e=e.toString()),this._appendBuffer(re.from(e));return this};A.prototype._appendBuffer=function(e){this._bufs.push(e),this.length+=e.length};A.prototype.indexOf=function(r,e,t){if(t===void 0&&typeof e=="string"&&(t=e,e=void 0),typeof r=="function"||Array.isArray(r))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if(typeof r=="number"?r=re.from([r]):typeof r=="string"?r=re.from(r,t):this._isBufferList(r)?r=r.slice():Array.isArray(r.buffer)?r=re.from(r.buffer,r.byteOffset,r.byteLength):re.isBuffer(r)||(r=re.from(r)),e=Number(e||0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),r.length===0)return e>this.length?this.length:e;let n=this._offset(e),i=n[0],s=n[1];for(;i<this._bufs.length;i++){let o=this._bufs[i];for(;s<o.length;)if(o.length-s>=r.length){let c=o.indexOf(r,s);if(c!==-1)return this._reverseOffset([i,c]);s=o.length-r.length+1}else{let c=this._reverseOffset([i,s]);if(this._match(c,r))return c;s++}s=0}return-1};A.prototype._match=function(r,e){if(this.length-r<e.length)return!1;for(let t=0;t<e.length;t++)if(this.get(r+t)!==e[t])return!1;return!0};(function(){let r={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(let e in r)(function(t){r[t]===null?A.prototype[t]=function(n,i){return this.slice(n,n+i)[t](0,i)}:A.prototype[t]=function(n=0){return this.slice(n,n+r[t])[t](0)}})(e)})();A.prototype._isBufferList=function(e){return e instanceof A||A.isBufferList(e)};A.isBufferList=function(e){return e!=null&&e[js]};Ds.exports=A});var yr=m((gf,Us)=>{u();"use strict";var Ns=pt(),{Buffer:Pu}=ge(),Rs=(r,e,t)=>{let n=Ns.encode(r,e,t);return Rs.bytes=Ns.encode.bytes,e||Pu.from(n)};Us.exports=Rs});var Gs=m((mf,Bt)=>{u();"use strict";var{Buffer:zs}=ge(),qs=dr(),Ws=yr(),gr=8,Hs=10*1024;function $s(r){r=r||{};let e=Math.max(r.poolSize||Hs,r.minPoolSize||gr),t=r.lengthEncoder||Ws;return async function*(i){let s=zs.alloc(e),o=0;for await(let a of i){t(a.length,s,o);let c=s.slice(o,o+t.bytes);o+=t.bytes,s.length-o<gr&&(s=zs.alloc(e),o=0),yield new qs().append(c).append(a)}}}$s.single=(r,e)=>{e=e||{};let t=e.lengthEncoder||Ws;return new qs([t(r.length),r.slice()])};Bt.exports=$s;Bt.exports.MIN_POOL_SIZE=gr;Bt.exports.DEFAULT_POOL_SIZE=Hs});var mr=m((wf,Qs)=>{u();"use strict";var Vs=pt(),{Buffer:ju}=ge(),Du=r=>new Proxy({},{get:(e,t)=>t[0]==="l"?r[t]:r.get(parseInt(t))}),Js=r=>{let e=Vs.decode(ju.isBuffer(r)?r:Du(r));return Js.bytes=Vs.decode.bytes,e};Qs.exports=Js});var Ys=m((bf,vt)=>{u();"use strict";var{Buffer:Nu}=ge(),wr=dr(),Ru=mr(),Xs=8,Ks=1024*1024*4,Zs=Nu.alloc(0),xe={LENGTH:"readLength",DATA:"readData"},Uu={[xe.LENGTH]:(r,e,t,n)=>{e=e.append(r);let i;try{i=n.lengthDecoder(e)}catch(s){if(e.length>n.maxLengthLength)throw Object.assign(s,{message:"message length too long",code:"ERR_MSG_LENGTH_TOO_LONG"});if(s instanceof RangeError)return{mode:xe.LENGTH,buffer:e,chunk:void 0,state:void 0,data:void 0};throw s}if(i>n.maxDataLength)throw Object.assign(new Error("message data too long"),{code:"ERR_MSG_DATA_TOO_LONG"});return r=e.shallowSlice(n.lengthDecoder.bytes),e=new wr,n.onLength&&n.onLength(i),i<=0?(n.onData&&n.onData(Zs),{mode:xe.LENGTH,chunk:r,buffer:e,data:Zs}):{mode:xe.DATA,chunk:r,buffer:e,state:{dataLength:i},data:void 0}},[xe.DATA]:(r,e,t,n)=>{if(e=e.append(r),!t)throw new Error("state is required");if(e.length<t.dataLength)return{mode:xe.DATA,buffer:e,state:t,chunk:void 0,data:void 0};let{dataLength:i}=t,s=e.shallowSlice(0,i),o=e.length>i?e.shallowSlice(i):void 0;return e=new wr,n.onData&&n.onData(s),{mode:xe.LENGTH,chunk:o,buffer:e,state:void 0,data:s}}};function br(r){r=r||{};let e={lengthDecoder:r.lengthDecoder||Ru,maxLengthLength:r.maxLengthLength||Xs,maxDataLength:r.maxDataLength||Ks,onLength:r.onLength,onData:r.onData};return async function*(n){let i=new wr,s=xe.LENGTH,o;for await(let a of n){let c=a;for(;c;){let l=Uu[s](c,i,o,e);s=l.mode,c=l.chunk,i=l.buffer,o=l.state,l.data&&(yield l.data)}}if(i.length)throw Object.assign(new Error("unexpected end of input"),{code:"ERR_UNEXPECTED_EOF"})}}br.fromReader=(r,e)=>{let t=1,n={[Symbol.asyncIterator](){return this},next:async()=>{try{return await r.next(t)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}};return br({...e||{},onLength:s=>{t=s}})(n)};vt.exports=br;vt.exports.MAX_LENGTH_LENGTH=Xs;vt.exports.MAX_DATA_LENGTH=Ks});var ro=m((_f,to)=>{u();"use strict";var{Buffer:zu}=ge(),eo=(r,e,t)=>(e=e||zu.allocUnsafe(4),e.writeInt32BE(r,t),e);eo.bytes=4;to.exports=eo});var so=m((xf,io)=>{u();"use strict";var no=r=>{if(r.length<4)throw RangeError("Could not decode int32BE");return r.readInt32BE(0)};no.bytes=4;io.exports=no});var oo=m(Fe=>{u();"use strict";Fe.encode=Gs();Fe.decode=Ys();Fe.varintEncode=yr();Fe.varintDecode=mr();Fe.int32BEEncode=ro();Fe.int32BEDecode=so()});var uo=m((vf,$e)=>{u();var ao=(...r)=>{let e;for(;r.length;)e=r.shift()(e);return e},_r=r=>r&&(typeof r[Symbol.asyncIterator]=="function"||typeof r[Symbol.iterator]=="function"||typeof r.next=="function"),Et=r=>r&&typeof r.sink=="function"&&_r(r.source),qu=r=>e=>(r.sink(e),r.source),co=(...r)=>{if(Et(r[0])){let e=r[0];r[0]=()=>e.source}else if(_r(r[0])){let e=r[0];r[0]=()=>e}if(r.length>1&&Et(r[r.length-1])&&(r[r.length-1]=r[r.length-1].sink),r.length>2)for(let e=1;e<r.length-1;e++)Et(r[e])&&(r[e]=qu(r[e]));return ao(...r)};$e.exports=co;$e.exports.pipe=co;$e.exports.rawPipe=ao;$e.exports.isIterable=_r;$e.exports.isDuplex=Et});var yo=m((Ef,po)=>{u();"use strict";var lo=()=>{},ho=Symbol.for("@libp2p/js-interfaces/topology"),fo=class{constructor({min:e=0,max:t=1/0,handlers:n={}}){this.min=e,this.max=t,this._onConnect=n.onConnect||lo,this._onDisconnect=n.onDisconnect||lo,this.peers=new Set}get[Symbol.toStringTag](){return"Topology"}get[ho](){return!0}static isTopology(e){return Boolean(e&&e[ho])}async setRegistrar(e){this._registrar=e}disconnect(e){this._onDisconnect(e)}};po.exports=fo});var xo=m((kf,_o)=>{u();"use strict";var Wu=yo(),go=Symbol.for("@libp2p/js-interfaces/topology/multicodec-topology"),mo=Xt(),wo=Object.assign(mo("libp2p:topology:multicodec-topology"),{error:mo("libp2p:topology:multicodec-topology:error")}),bo=class extends Wu{constructor({min:e,max:t,multicodecs:n,handlers:i}){super({min:e,max:t,handlers:i});if(!n)throw new Error("one or more multicodec should be provided");if(!i)throw new Error("the handlers should be provided");if(typeof i.onConnect!="function")throw new Error("the 'onConnect' handler must be provided");if(typeof i.onDisconnect!="function")throw new Error("the 'onDisconnect' handler must be provided");this.multicodecs=Array.isArray(n)?n:[n],this._registrar=void 0,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerConnect=this._onPeerConnect.bind(this)}get[Symbol.toStringTag](){return"Topology"}get[go](){return!0}static isMulticodecTopology(e){return Boolean(e&&e[go])}async setRegistrar(e){this._registrar=e,this._registrar.peerStore.on("change:protocols",this._onProtocolChange),this._registrar.connectionManager.on("peer:connect",this._onPeerConnect),await this._updatePeers(this._registrar.peerStore.getPeers())}async _updatePeers(e){for await(let{id:t,protocols:n}of e)if(this.multicodecs.filter(i=>n.includes(i)).length){this.peers.add(t.toB58String());let i=this._registrar.getConnection(t);i&&this._onConnect(t,i)}else this.peers.delete(t.toB58String())}async _onProtocolChange({peerId:e,protocols:t}){try{let n=this.peers.has(e.toB58String()),i=t.filter(s=>this.multicodecs.includes(s));n&&i.length===0&&this._onDisconnect(e);for(let s of t)if(this.multicodecs.includes(s)){let o=await this._registrar.peerStore.get(e);await this._updatePeers([o]);return}}catch(n){wo.error(n)}}async _onPeerConnect(e){try{let t=e.remotePeer,n=await this._registrar.peerStore.protoBook.get(t);if(!n)return;this.multicodecs.find(i=>n.includes(i))&&(this.peers.add(t.toB58String()),this._onConnect(t,e))}catch(t){wo.error(t)}}};_o.exports=bo});var At=m(($f,Mr)=>{u();"use strict";var Ge=typeof Reflect=="object"?Reflect:null,Co=Ge&&typeof Ge.apply=="function"?Ge.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},St;Ge&&typeof Ge.ownKeys=="function"?St=Ge.ownKeys:Object.getOwnPropertySymbols?St=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:St=function(e){return Object.getOwnPropertyNames(e)};function Ju(r){console&&console.warn&&console.warn(r)}var Ao=Number.isNaN||function(e){return e!==e};function S(){S.init.call(this)}Mr.exports=S;Mr.exports.once=Zu;S.EventEmitter=S;S.prototype._events=void 0;S.prototype._eventsCount=0;S.prototype._maxListeners=void 0;var To=10;function Ct(r){if(typeof r!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof r)}Object.defineProperty(S,"defaultMaxListeners",{enumerable:!0,get:function(){return To},set:function(r){if(typeof r!="number"||r<0||Ao(r))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+r+".");To=r}});S.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};S.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Ao(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Fo(r){return r._maxListeners===void 0?S.defaultMaxListeners:r._maxListeners}S.prototype.getMaxListeners=function(){return Fo(this)};S.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")Co(c,this,t);else for(var l=c.length,h=Po(c,l),n=0;n<l;++n)Co(h[n],this,t);return!0};function Mo(r,e,t,n){var i,s,o;if(Ct(t),s=r._events,s===void 0?(s=r._events=Object.create(null),r._eventsCount=0):(s.newListener!==void 0&&(r.emit("newListener",e,t.listener?t.listener:t),s=r._events),o=s[e]),o===void 0)o=s[e]=t,++r._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=Fo(r),i>0&&o.length>i&&!o.warned){o.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=r,a.type=e,a.count=o.length,Ju(a)}return r}S.prototype.addListener=function(e,t){return Mo(this,e,t,!1)};S.prototype.on=S.prototype.addListener;S.prototype.prependListener=function(e,t){return Mo(this,e,t,!0)};function Qu(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Lo(r,e,t){var n={fired:!1,wrapFn:void 0,target:r,type:e,listener:t},i=Qu.bind(n);return i.listener=t,n.wrapFn=i,i}S.prototype.once=function(e,t){return Ct(t),this.on(e,Lo(this,e,t)),this};S.prototype.prependOnceListener=function(e,t){return Ct(t),this.prependListener(e,Lo(this,e,t)),this};S.prototype.removeListener=function(e,t){var n,i,s,o,a;if(Ct(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount==0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){a=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():Xu(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,a||t)}return this};S.prototype.off=S.prototype.removeListener;S.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function Oo(r,e,t){var n=r._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?Ku(i):Po(i,i.length)}S.prototype.listeners=function(e){return Oo(this,e,!0)};S.prototype.rawListeners=function(e){return Oo(this,e,!1)};S.listenerCount=function(r,e){return typeof r.listenerCount=="function"?r.listenerCount(e):Io.call(r,e)};S.prototype.listenerCount=Io;function Io(r){var e=this._events;if(e!==void 0){var t=e[r];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}S.prototype.eventNames=function(){return this._eventsCount>0?St(this._events):[]};function Po(r,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=r[n];return t}function Xu(r,e){for(;e+1<r.length;e++)r[e]=r[e+1];r.pop()}function Ku(r){for(var e=new Array(r.length),t=0;t<e.length;++t)e[t]=r[t].listener||r[t];return e}function Zu(r,e){return new Promise(function(t,n){function i(o){r.removeListener(e,s),n(o)}function s(){typeof r.removeListener=="function"&&r.removeListener("error",i),t([].slice.call(arguments))}jo(r,e,s,{once:!0}),e!=="error"&&Yu(r,i,{once:!0})})}function Yu(r,e,t){typeof r.on=="function"&&jo(r,"error",e,t)}function jo(r,e,t,n){if(typeof r.on=="function")n.once?r.once(e,t):r.on(e,t);else if(typeof r.addEventListener=="function")r.addEventListener(e,function i(s){n.once&&r.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof r)}});var Go=m((Ho,$o)=>{u();"use strict";var wl=Math.exp;Ho=$o.exports=function(e){if(typeof e!="number")throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let t,n=0,i=0,s=0,o,a={};function c(l,h){return 1-wl(-(l-h)/e)}return a.push=function(h,p){if(o){let w=c(h,o),M=p-t,b=w*M;t=w*p+(1-w)*t,n=(1-w)*(n+M*b),i=Math.sqrt(n),s=t+w*M}else t=p;o=h},a.movingAverage=function(){return t},a.variance=function(){return n},a.deviation=function(){return i},a.forecast=function(){return s},a}});var Zo=m((xp,Gr)=>{u();var{AbortController:bl}=globalThis;function Ko(r){let e=new bl;function t(){e.abort();for(let n of r)!n||!n.removeEventListener||n.removeEventListener("abort",t)}for(let n of r)if(!(!n||!n.addEventListener)){if(n.aborted){t();break}n.addEventListener("abort",t)}return e.signal}Gr.exports=Ko;Gr.exports.anySignal=Ko});var ea=m((Bp,Yo)=>{u();"use strict";var _l=async r=>{for await(let e of r);};Yo.exports=_l});var ra=m((vp,ta)=>{u();"use strict";var xl=async function*(r,e){for await(let t of r)await e(t)&&(yield t)};ta.exports=xl});var ia=m((Ep,na)=>{u();"use strict";var Bl=async function*(r,e){let t=0;if(!(e<1)){for await(let n of r)if(yield n,t++,t===e)return}};na.exports=Bl});var oa=m((kp,sa)=>{u();"use strict";var vl=async r=>{let e=[];for await(let t of r)e.push(t);return e};sa.exports=vl});var Cl={};J(Cl,{createBitswap:()=>Sl});u();u();u();u();u();u();u();var Ka=kn,En=128,Za=127,Ya=~Za,ec=Math.pow(2,31);function kn(r,e,t){e=e||[],t=t||0;for(var n=t;r>=ec;)e[t++]=r&255|En,r/=128;for(;r&Ya;)e[t++]=r&255|En,r>>>=7;return e[t]=r|0,kn.bytes=t-n+1,e}var tc=qt,rc=128,Sn=127;function qt(r,e){var t=0,e=e||0,n=0,i=e,s,o=r.length;do{if(i>=o)throw qt.bytes=0,new RangeError("Could not decode varint");s=r[i++],t+=n<28?(s&Sn)<<n:(s&Sn)*Math.pow(2,n),n+=7}while(s>=rc);return qt.bytes=i-e,t}var nc=Math.pow(2,7),ic=Math.pow(2,14),sc=Math.pow(2,21),oc=Math.pow(2,28),ac=Math.pow(2,35),cc=Math.pow(2,42),uc=Math.pow(2,49),lc=Math.pow(2,56),hc=Math.pow(2,63),fc=function(r){return r<nc?1:r<ic?2:r<sc?3:r<oc?4:r<ac?5:r<cc?6:r<uc?7:r<lc?8:r<hc?9:10},pc={encode:Ka,decode:tc,encodingLength:fc},dc=pc,Je=dc;var Qe=r=>[Je.decode(r),Je.decode.bytes],Ne=(r,e,t=0)=>(Je.encode(r,e,t),e),Re=r=>Je.encodingLength(r);u();u();var Dl=new Uint8Array(0);var An=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},de=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var Tn=r=>new TextEncoder().encode(r),Fn=r=>new TextDecoder().decode(r);var ke=(r,e)=>{let t=e.byteLength,n=Re(r),i=n+Re(t),s=new Uint8Array(i+t);return Ne(r,s,0),Ne(t,s,n),s.set(e,i),new Xe(r,t,e,s)},Ln=r=>{let e=de(r),[t,n]=Qe(e),[i,s]=Qe(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new Xe(t,i,o,e)},On=(r,e)=>r===e?!0:r.code===e.code&&r.size===e.size&&An(r.bytes,e.bytes),Xe=class{constructor(e,t,n,i){this.code=e,this.size=t,this.digest=n,this.bytes=i}};var Wt={};J(Wt,{base58btc:()=>B,base58flickr:()=>_c});u();u();u();function yc(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),h=Math.log(256)/Math.log(a);function p(b){if(b instanceof Uint8Array||(ArrayBuffer.isView(b)?b=new Uint8Array(b.buffer,b.byteOffset,b.byteLength):Array.isArray(b)&&(b=Uint8Array.from(b))),!(b instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(b.length===0)return"";for(var C=0,I=0,P=0,R=b.length;P!==R&&b[P]===0;)P++,C++;for(var $=(R-P)*h+1>>>0,N=new Uint8Array($);P!==R;){for(var Z=b[P],G=0,q=$-1;(Z!==0||G<I)&&q!==-1;q--,G++)Z+=256*N[q]>>>0,N[q]=Z%a>>>0,Z=Z/a>>>0;if(Z!==0)throw new Error("Non-zero carry");I=G,P++}for(var V=$-I;V!==$&&N[V]===0;)V++;for(var Le=c.repeat(C);V<$;++V)Le+=r.charAt(N[V]);return Le}function w(b){if(typeof b!="string")throw new TypeError("Expected String");if(b.length===0)return new Uint8Array;var C=0;if(b[C]!==" "){for(var I=0,P=0;b[C]===c;)I++,C++;for(var R=(b.length-C)*l+1>>>0,$=new Uint8Array(R);b[C];){var N=t[b.charCodeAt(C)];if(N===255)return;for(var Z=0,G=R-1;(N!==0||Z<P)&&G!==-1;G--,Z++)N+=a*$[G]>>>0,$[G]=N%256>>>0,N=N/256>>>0;if(N!==0)throw new Error("Non-zero carry");P=Z,C++}if(b[C]!==" "){for(var q=R-P;q!==R&&$[q]===0;)q++;for(var V=new Uint8Array(I+(R-q)),Le=I;q!==R;)V[Le++]=$[q++];return V}}}function M(b){var C=w(b);if(C)return C;throw new Error(`Non-${e} character`)}return{encode:p,decodeUnsafe:w,decode:M}}var gc=yc,mc=gc,Pn=mc;var jn=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},Dn=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseDecode=n}decode(e){if(typeof e=="string")switch(e[0]){case this.prefix:return this.baseDecode(e.slice(1));default:throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`)}else throw Error("Can only multibase decode strings")}or(e){return Rn(this,e)}},Nn=class{constructor(e){this.decoders=e}or(e){return Rn(this,e)}decode(e){let t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Rn=(r,e)=>new Nn({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),Un=class{constructor(e,t,n,i){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new jn(e,t,n),this.decoder=new Dn(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},lt=({name:r,prefix:e,encode:t,decode:n})=>new Un(r,e,t,n),me=({prefix:r,name:e,alphabet:t})=>{let{encode:n,decode:i}=Pn(t,e);return lt({prefix:r,name:e,encode:n,decode:s=>de(i(s))})},wc=(r,e,t,n)=>{let i={};for(let h=0;h<e.length;++h)i[e[h]]=h;let s=r.length;for(;r[s-1]==="=";)--s;let o=new Uint8Array(s*t/8|0),a=0,c=0,l=0;for(let h=0;h<s;++h){let p=i[r[h]];if(p===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|p,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},bc=(r,e,t)=>{let n=e[e.length-1]==="=",i=(1<<t)-1,s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o&&(s+=e[i&a<<t-o]),n)for(;s.length*t&7;)s+="=";return s},F=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>lt({prefix:e,name:r,encode(i){return bc(i,n,t)},decode(i){return wc(i,n,t,r)}});var B=me({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),_c=me({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ht={};J(Ht,{base32:()=>Ue,base32hex:()=>Ec,base32hexpad:()=>Sc,base32hexpadupper:()=>Cc,base32hexupper:()=>kc,base32pad:()=>Bc,base32padupper:()=>vc,base32upper:()=>xc,base32z:()=>Ac});u();var Ue=F({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),xc=F({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Bc=F({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),vc=F({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Ec=F({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),kc=F({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Sc=F({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Cc=F({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Ac=F({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var E=class{constructor(e,t,n,i){this.code=t,this.version=e,this.multihash=n,this.bytes=i,this.byteOffset=i.byteOffset,this.byteLength=i.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:ft,byteLength:ft,code:ht,version:ht,multihash:ht,bytes:ht,_baseCache:ft,asCID:ft})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:t}=this;if(e!==Ke)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Lc)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return E.createV0(t)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,n=ke(e,t);return E.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&On(this.multihash,e.multihash)}toString(e){let{bytes:t,version:n,_baseCache:i}=this;switch(n){case 0:return Fc(t,i,e||B.encoder);default:return Mc(t,i,e||Ue.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return Ic(/^0\.0/,Pc),!!(e&&(e[qn]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof E)return e;if(e!=null&&e.asCID===e){let{version:t,code:n,multihash:i,bytes:s}=e;return new E(t,n,i,s||zn(t,n,i.bytes))}else if(e!=null&&e[qn]===!0){let{version:t,multihash:n,code:i}=e,s=Ln(n);return E.create(t,i,s)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(t!==Ke)throw new Error(`Version 0 CID must use dag-pb (code: ${Ke}) block encoding`);return new E(e,t,n,n.bytes)}case 1:{let i=zn(e,t,n.bytes);return new E(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return E.create(0,Ke,e)}static createV1(e,t){return E.create(1,e,t)}static decode(e){let[t,n]=E.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=E.inspectBytes(e),n=t.size-t.multihashSize,i=de(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");let s=i.subarray(t.multihashSize-t.digestSize),o=new Xe(t.multihashCode,t.digestSize,s,i);return[t.version===0?E.createV0(o):E.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,n=()=>{let[p,w]=Qe(e.subarray(t));return t+=w,p},i=n(),s=Ke;if(i===18?(i=0,t=0):i===1&&(s=n()),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);let o=t,a=n(),c=n(),l=t+c,h=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:h,size:l}}static parse(e,t){let[n,i]=Tc(e,t),s=E.decode(i);return s._baseCache.set(n,e),s}},Tc=(r,e)=>{switch(r[0]){case"Q":{let t=e||B;return[B.prefix,t.decode(`${B.prefix}${r}`)]}case B.prefix:{let t=e||B;return[B.prefix,t.decode(r)]}case Ue.prefix:{let t=e||Ue;return[Ue.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Fc=(r,e,t)=>{let{prefix:n}=t;if(n!==B.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let i=e.get(n);if(i==null){let s=t.encode(r).slice(1);return e.set(n,s),s}else return i},Mc=(r,e,t)=>{let{prefix:n}=t,i=e.get(n);if(i==null){let s=t.encode(r);return e.set(n,s),s}else return i},Ke=112,Lc=18,zn=(r,e,t)=>{let n=Re(r),i=n+Re(e),s=new Uint8Array(i+t.byteLength);return Ne(r,s,0),Ne(e,s,n),s.set(t,i),s},qn=Symbol.for("@ipld/js-cid/CID"),ht={writable:!1,configurable:!1,enumerable:!0},ft={writable:!1,enumerable:!1,configurable:!1},Oc="0.0.0-dev",Ic=(r,e)=>{if(r.test(Oc))console.warn(e);else throw new Error(e)},Pc=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var Gt={};J(Gt,{sha256:()=>Ze,sha512:()=>jc});u();u();var $t=({name:r,code:e,encode:t})=>new Wn(r,e,t),Wn=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?ke(this.code,t):t.then(n=>ke(this.code,n))}else throw Error("Unknown type, must be binary type")}};var $n=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Ze=$t({name:"sha2-256",code:18,encode:$n("SHA-256")}),jc=$t({name:"sha2-512",code:19,encode:$n("SHA-512")});var ks=T(si());u();var Ye=T(pt());function uu(r){let e=new Uint8Array(r.reduce((n,i)=>n+Ye.default.encodingLength(i),0)),t=0;for(let n of r)e=Ye.encode(n,e,t),t+=Ye.default.encodingLength(n);return e}var yi=uu;u();var lr=T(Xt());u();function _i(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}u();u();u();var gt=class{constructor(e,t,n){this._refCounter=1,this.cid=e,this.priority=t||1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){return`WantlistEntry <key: ${this.cid.toString(B)}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}};u();var te=T(ms()),ue=te.default.Reader,nt=te.default.Writer,v=te.default.util,_=te.default.roots["ipfs-bitswap"]||(te.default.roots["ipfs-bitswap"]={}),H=_.Message=(()=>{function r(e){if(this.blocks=[],this.payload=[],this.blockPresences=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)e[t[n]]!=null&&(this[t[n]]=e[t[n]])}return r.prototype.wantlist=null,r.prototype.blocks=v.emptyArray,r.prototype.payload=v.emptyArray,r.prototype.blockPresences=v.emptyArray,r.prototype.pendingBytes=0,r.encode=function(t,n){if(n||(n=nt.create()),t.wantlist!=null&&Object.hasOwnProperty.call(t,"wantlist")&&_.Message.Wantlist.encode(t.wantlist,n.uint32(10).fork()).ldelim(),t.blocks!=null&&t.blocks.length)for(var i=0;i<t.blocks.length;++i)n.uint32(18).bytes(t.blocks[i]);if(t.payload!=null&&t.payload.length)for(var i=0;i<t.payload.length;++i)_.Message.Block.encode(t.payload[i],n.uint32(26).fork()).ldelim();if(t.blockPresences!=null&&t.blockPresences.length)for(var i=0;i<t.blockPresences.length;++i)_.Message.BlockPresence.encode(t.blockPresences[i],n.uint32(34).fork()).ldelim();return t.pendingBytes!=null&&Object.hasOwnProperty.call(t,"pendingBytes")&&n.uint32(40).int32(t.pendingBytes),n},r.decode=function(t,n){t instanceof ue||(t=ue.create(t));for(var i=n===void 0?t.len:t.pos+n,s=new _.Message;t.pos<i;){var o=t.uint32();switch(o>>>3){case 1:s.wantlist=_.Message.Wantlist.decode(t,t.uint32());break;case 2:s.blocks&&s.blocks.length||(s.blocks=[]),s.blocks.push(t.bytes());break;case 3:s.payload&&s.payload.length||(s.payload=[]),s.payload.push(_.Message.Block.decode(t,t.uint32()));break;case 4:s.blockPresences&&s.blockPresences.length||(s.blockPresences=[]),s.blockPresences.push(_.Message.BlockPresence.decode(t,t.uint32()));break;case 5:s.pendingBytes=t.int32();break;default:t.skipType(o&7);break}}return s},r.fromObject=function(t){if(t instanceof _.Message)return t;var n=new _.Message;if(t.wantlist!=null){if(typeof t.wantlist!="object")throw TypeError(".Message.wantlist: object expected");n.wantlist=_.Message.Wantlist.fromObject(t.wantlist)}if(t.blocks){if(!Array.isArray(t.blocks))throw TypeError(".Message.blocks: array expected");n.blocks=[];for(var i=0;i<t.blocks.length;++i)typeof t.blocks[i]=="string"?v.base64.decode(t.blocks[i],n.blocks[i]=v.newBuffer(v.base64.length(t.blocks[i])),0):t.blocks[i].length&&(n.blocks[i]=t.blocks[i])}if(t.payload){if(!Array.isArray(t.payload))throw TypeError(".Message.payload: array expected");n.payload=[];for(var i=0;i<t.payload.length;++i){if(typeof t.payload[i]!="object")throw TypeError(".Message.payload: object expected");n.payload[i]=_.Message.Block.fromObject(t.payload[i])}}if(t.blockPresences){if(!Array.isArray(t.blockPresences))throw TypeError(".Message.blockPresences: array expected");n.blockPresences=[];for(var i=0;i<t.blockPresences.length;++i){if(typeof t.blockPresences[i]!="object")throw TypeError(".Message.blockPresences: object expected");n.blockPresences[i]=_.Message.BlockPresence.fromObject(t.blockPresences[i])}}return t.pendingBytes!=null&&(n.pendingBytes=t.pendingBytes|0),n},r.toObject=function(t,n){n||(n={});var i={};if((n.arrays||n.defaults)&&(i.blocks=[],i.payload=[],i.blockPresences=[]),n.defaults&&(i.wantlist=null,i.pendingBytes=0),t.wantlist!=null&&t.hasOwnProperty("wantlist")&&(i.wantlist=_.Message.Wantlist.toObject(t.wantlist,n)),t.blocks&&t.blocks.length){i.blocks=[];for(var s=0;s<t.blocks.length;++s)i.blocks[s]=n.bytes===String?v.base64.encode(t.blocks[s],0,t.blocks[s].length):n.bytes===Array?Array.prototype.slice.call(t.blocks[s]):t.blocks[s]}if(t.payload&&t.payload.length){i.payload=[];for(var s=0;s<t.payload.length;++s)i.payload[s]=_.Message.Block.toObject(t.payload[s],n)}if(t.blockPresences&&t.blockPresences.length){i.blockPresences=[];for(var s=0;s<t.blockPresences.length;++s)i.blockPresences[s]=_.Message.BlockPresence.toObject(t.blockPresences[s],n)}return t.pendingBytes!=null&&t.hasOwnProperty("pendingBytes")&&(i.pendingBytes=t.pendingBytes),i},r.prototype.toJSON=function(){return this.constructor.toObject(this,te.default.util.toJSONOptions)},r.Wantlist=function(){function e(t){if(this.entries=[],t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.entries=v.emptyArray,e.prototype.full=!1,e.encode=function(n,i){if(i||(i=nt.create()),n.entries!=null&&n.entries.length)for(var s=0;s<n.entries.length;++s)_.Message.Wantlist.Entry.encode(n.entries[s],i.uint32(10).fork()).ldelim();return n.full!=null&&Object.hasOwnProperty.call(n,"full")&&i.uint32(16).bool(n.full),i},e.decode=function(n,i){n instanceof ue||(n=ue.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new _.Message.Wantlist;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.entries&&o.entries.length||(o.entries=[]),o.entries.push(_.Message.Wantlist.Entry.decode(n,n.uint32()));break;case 2:o.full=n.bool();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof _.Message.Wantlist)return n;var i=new _.Message.Wantlist;if(n.entries){if(!Array.isArray(n.entries))throw TypeError(".Message.Wantlist.entries: array expected");i.entries=[];for(var s=0;s<n.entries.length;++s){if(typeof n.entries[s]!="object")throw TypeError(".Message.Wantlist.entries: object expected");i.entries[s]=_.Message.Wantlist.Entry.fromObject(n.entries[s])}}return n.full!=null&&(i.full=Boolean(n.full)),i},e.toObject=function(n,i){i||(i={});var s={};if((i.arrays||i.defaults)&&(s.entries=[]),i.defaults&&(s.full=!1),n.entries&&n.entries.length){s.entries=[];for(var o=0;o<n.entries.length;++o)s.entries[o]=_.Message.Wantlist.Entry.toObject(n.entries[o],i)}return n.full!=null&&n.hasOwnProperty("full")&&(s.full=n.full),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,te.default.util.toJSONOptions)},e.WantType=function(){let t={},n=Object.create(t);return n[t[0]="Block"]=0,n[t[1]="Have"]=1,n}(),e.Entry=function(){function t(n){if(n)for(var i=Object.keys(n),s=0;s<i.length;++s)n[i[s]]!=null&&(this[i[s]]=n[i[s]])}return t.prototype.block=v.newBuffer([]),t.prototype.priority=0,t.prototype.cancel=!1,t.prototype.wantType=0,t.prototype.sendDontHave=!1,t.encode=function(i,s){return s||(s=nt.create()),i.block!=null&&Object.hasOwnProperty.call(i,"block")&&s.uint32(10).bytes(i.block),i.priority!=null&&Object.hasOwnProperty.call(i,"priority")&&s.uint32(16).int32(i.priority),i.cancel!=null&&Object.hasOwnProperty.call(i,"cancel")&&s.uint32(24).bool(i.cancel),i.wantType!=null&&Object.hasOwnProperty.call(i,"wantType")&&s.uint32(32).int32(i.wantType),i.sendDontHave!=null&&Object.hasOwnProperty.call(i,"sendDontHave")&&s.uint32(40).bool(i.sendDontHave),s},t.decode=function(i,s){i instanceof ue||(i=ue.create(i));for(var o=s===void 0?i.len:i.pos+s,a=new _.Message.Wantlist.Entry;i.pos<o;){var c=i.uint32();switch(c>>>3){case 1:a.block=i.bytes();break;case 2:a.priority=i.int32();break;case 3:a.cancel=i.bool();break;case 4:a.wantType=i.int32();break;case 5:a.sendDontHave=i.bool();break;default:i.skipType(c&7);break}}return a},t.fromObject=function(i){if(i instanceof _.Message.Wantlist.Entry)return i;var s=new _.Message.Wantlist.Entry;switch(i.block!=null&&(typeof i.block=="string"?v.base64.decode(i.block,s.block=v.newBuffer(v.base64.length(i.block)),0):i.block.length&&(s.block=i.block)),i.priority!=null&&(s.priority=i.priority|0),i.cancel!=null&&(s.cancel=Boolean(i.cancel)),i.wantType){case"Block":case 0:s.wantType=0;break;case"Have":case 1:s.wantType=1;break}return i.sendDontHave!=null&&(s.sendDontHave=Boolean(i.sendDontHave)),s},t.toObject=function(i,s){s||(s={});var o={};return s.defaults&&(s.bytes===String?o.block="":(o.block=[],s.bytes!==Array&&(o.block=v.newBuffer(o.block))),o.priority=0,o.cancel=!1,o.wantType=s.enums===String?"Block":0,o.sendDontHave=!1),i.block!=null&&i.hasOwnProperty("block")&&(o.block=s.bytes===String?v.base64.encode(i.block,0,i.block.length):s.bytes===Array?Array.prototype.slice.call(i.block):i.block),i.priority!=null&&i.hasOwnProperty("priority")&&(o.priority=i.priority),i.cancel!=null&&i.hasOwnProperty("cancel")&&(o.cancel=i.cancel),i.wantType!=null&&i.hasOwnProperty("wantType")&&(o.wantType=s.enums===String?_.Message.Wantlist.WantType[i.wantType]:i.wantType),i.sendDontHave!=null&&i.hasOwnProperty("sendDontHave")&&(o.sendDontHave=i.sendDontHave),o},t.prototype.toJSON=function(){return this.constructor.toObject(this,te.default.util.toJSONOptions)},t}(),e}(),r.Block=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.prefix=v.newBuffer([]),e.prototype.data=v.newBuffer([]),e.encode=function(n,i){return i||(i=nt.create()),n.prefix!=null&&Object.hasOwnProperty.call(n,"prefix")&&i.uint32(10).bytes(n.prefix),n.data!=null&&Object.hasOwnProperty.call(n,"data")&&i.uint32(18).bytes(n.data),i},e.decode=function(n,i){n instanceof ue||(n=ue.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new _.Message.Block;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.prefix=n.bytes();break;case 2:o.data=n.bytes();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof _.Message.Block)return n;var i=new _.Message.Block;return n.prefix!=null&&(typeof n.prefix=="string"?v.base64.decode(n.prefix,i.prefix=v.newBuffer(v.base64.length(n.prefix)),0):n.prefix.length&&(i.prefix=n.prefix)),n.data!=null&&(typeof n.data=="string"?v.base64.decode(n.data,i.data=v.newBuffer(v.base64.length(n.data)),0):n.data.length&&(i.data=n.data)),i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.prefix="":(s.prefix=[],i.bytes!==Array&&(s.prefix=v.newBuffer(s.prefix))),i.bytes===String?s.data="":(s.data=[],i.bytes!==Array&&(s.data=v.newBuffer(s.data)))),n.prefix!=null&&n.hasOwnProperty("prefix")&&(s.prefix=i.bytes===String?v.base64.encode(n.prefix,0,n.prefix.length):i.bytes===Array?Array.prototype.slice.call(n.prefix):n.prefix),n.data!=null&&n.hasOwnProperty("data")&&(s.data=i.bytes===String?v.base64.encode(n.data,0,n.data.length):i.bytes===Array?Array.prototype.slice.call(n.data):n.data),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,te.default.util.toJSONOptions)},e}(),r.BlockPresenceType=function(){let e={},t=Object.create(e);return t[e[0]="Have"]=0,t[e[1]="DontHave"]=1,t}(),r.BlockPresence=function(){function e(t){if(t)for(var n=Object.keys(t),i=0;i<n.length;++i)t[n[i]]!=null&&(this[n[i]]=t[n[i]])}return e.prototype.cid=v.newBuffer([]),e.prototype.type=0,e.encode=function(n,i){return i||(i=nt.create()),n.cid!=null&&Object.hasOwnProperty.call(n,"cid")&&i.uint32(10).bytes(n.cid),n.type!=null&&Object.hasOwnProperty.call(n,"type")&&i.uint32(16).int32(n.type),i},e.decode=function(n,i){n instanceof ue||(n=ue.create(n));for(var s=i===void 0?n.len:n.pos+i,o=new _.Message.BlockPresence;n.pos<s;){var a=n.uint32();switch(a>>>3){case 1:o.cid=n.bytes();break;case 2:o.type=n.int32();break;default:n.skipType(a&7);break}}return o},e.fromObject=function(n){if(n instanceof _.Message.BlockPresence)return n;var i=new _.Message.BlockPresence;switch(n.cid!=null&&(typeof n.cid=="string"?v.base64.decode(n.cid,i.cid=v.newBuffer(v.base64.length(n.cid)),0):n.cid.length&&(i.cid=n.cid)),n.type){case"Have":case 0:i.type=0;break;case"DontHave":case 1:i.type=1;break}return i},e.toObject=function(n,i){i||(i={});var s={};return i.defaults&&(i.bytes===String?s.cid="":(s.cid=[],i.bytes!==Array&&(s.cid=v.newBuffer(s.cid))),s.type=i.enums===String?"Have":0),n.cid!=null&&n.hasOwnProperty("cid")&&(s.cid=i.bytes===String?v.base64.encode(n.cid,0,n.cid.length):i.bytes===Array?Array.prototype.slice.call(n.cid):n.cid),n.type!=null&&n.hasOwnProperty("type")&&(s.type=i.enums===String?_.Message.BlockPresenceType[n.type]:n.type),s},e.prototype.toJSON=function(){return this.constructor.toObject(this,te.default.util.toJSONOptions)},e}(),r})();var _s=T(it()),xs={Block:H.Wantlist.WantType.Block,Have:H.Wantlist.WantType.Have},Mu=(r,e)=>Array.prototype.slice.call(e,0).sort((t,n)=>{let i=r(t),s=r(n);return i<s?-1:i>s?1:0}),le=class{constructor(e,t){this.set=t?(0,_s.default)({system:"ipfs",component:"bitswap",metric:"wantlist",metrics:t.metrics}):new Map,this._stats=e}get length(){return this.set.size}add(e,t,n){let i=e.toString(B),s=this.set.get(i);s?(s.inc(),s.priority=t,s.wantType===xs.Have&&n===xs.Block&&(s.wantType=n)):(this.set.set(i,new gt(e,t,n)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(e){let t=e.toString(B),n=this.set.get(t);!n||(n.dec(),!n.hasRefs()&&(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){return this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map(Mu(e=>e[1].key,Array.from(this.set.entries())))}contains(e){let t=e.toString(B);return this.set.has(t)}get(e){let t=e.toString(B);return this.set.get(t)}};le.Entry=gt;var Lu=le.Entry,Te=class{constructor(e,t,n,i,s){this.entry=new Lu(e,t,n),this.cancel=Boolean(i),this.sendDontHave=Boolean(s)}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){return`BitswapMessageEntry ${this.cid.toString(B)} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}};var K=(r,e)=>{let t=["bitswap"];return e&&t.push(e),r&&t.push(`${r.toB58String().slice(0,8)}`),Object.assign((0,lr.default)(t.join(":")),{error:(0,lr.default)(t.concat(["error"]).join(":"))})};var xt=(r,e)=>{if(r.size!==e.size)return!1;for(let[t,n]of r){let i=e.get(t);if(i===void 0||n instanceof Uint8Array&&i instanceof Uint8Array&&!_i(n,i)||n instanceof Te&&i instanceof Te&&!n.equals(i))return!1}return!0};var Ss=T(Es()),k=class{constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return this.blocks.size===0&&this.wantlist.size===0&&this.blockPresences.size===0}addEntry(e,t,n,i,s){n==null&&(n=k.WantType.Block);let o=e.toString(B),a=this.wantlist.get(o);a?(a.wantType===n&&(a.priority=t),i&&(a.cancel=Boolean(i)),s&&(a.sendDontHave=Boolean(s)),n===k.WantType.Block&&a.wantType===k.WantType.Have&&(a.wantType=n)):this.wantlist.set(o,new Te(e,t,n,i,s))}addBlock(e,t){let n=e.toString(B);this.blocks.set(n,t)}addHave(e){let t=e.toString(B);this.blockPresences.has(t)||this.blockPresences.set(t,k.BlockPresenceType.Have)}addDontHave(e){let t=e.toString(B);this.blockPresences.has(t)||this.blockPresences.set(t,k.BlockPresenceType.DontHave)}cancel(e){let t=e.toString(B);this.wantlist.delete(t),this.addEntry(e,0,k.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),cancel:Boolean(t.cancel)})),full:this.full?!0:void 0},blocks:Array.from(this.blocks.values())};return H.encode(e).finish()}serializeToBitswap110(){let e={wantlist:{entries:Array.from(this.wantlist.values()).map(t=>({block:t.cid.bytes,priority:Number(t.priority),wantType:t.wantType,cancel:Boolean(t.cancel),sendDontHave:Boolean(t.sendDontHave)})),full:this.full?!0:void 0},blockPresences:[],payload:[],pendingBytes:this.pendingBytes};for(let[t,n]of this.blocks.entries()){let i=E.parse(t),s=i.version,o=i.code,a=i.multihash.code,c=i.multihash.digest.length,l=yi([s,o,a,c]);e.payload.push(new H.Block({prefix:l,data:n}))}for(let[t,n]of this.blockPresences)e.blockPresences.push(new H.BlockPresence({cid:E.parse(t).bytes,type:n}));return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),H.encode(e).finish()}equals(e){return!(this.full!==e.full||this.pendingBytes!==e.pendingBytes||!xt(this.wantlist,e.wantlist)||!xt(this.blocks,e.blocks)||!xt(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){let e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}};k.deserialize=async(r,e)=>{let t=H.decode(r),n=t.wantlist&&t.wantlist.full||!1,i=new k(n);return t.wantlist&&t.wantlist.entries&&t.wantlist.entries.forEach(s=>{if(!s.block)return;let o=E.decode(s.block);i.addEntry(o,s.priority||0,s.wantType,Boolean(s.cancel),Boolean(s.sendDontHave))}),t.blockPresences&&t.blockPresences.forEach(s=>{if(!s.cid)return;let o=E.decode(s.cid);s.type===k.BlockPresenceType.Have?i.addHave(o):i.addDontHave(o)}),t.blocks.length>0?(await Promise.all(t.blocks.map(async s=>{let o=await Ze.digest(s),a=E.createV0(o);i.addBlock(a,s)})),i):(t.payload.length>0&&(await Promise.all(t.payload.map(async s=>{if(!s.prefix||!s.data)return;let o=(0,ks.default)(s.prefix),a=o[0],c=o[1],l=o[2],h=l===Ze.code?Ze:e&&await e.getHasher(l);if(!h)throw(0,Ss.default)(new Error("Unknown hash algorithm"),"ERR_UNKNOWN_HASH_ALG");let p=await h.digest(s.data),w=E.create(a,c,p);i.addBlock(w,s.data)})),i.setPendingBytes(t.pendingBytes)),i)};k.blockPresenceSize=r=>r.bytes.length+1;k.Entry=Te;k.WantType={Block:H.Wantlist.WantType.Block,Have:H.Wantlist.WantType.Have};k.BlockPresenceType={Have:H.BlockPresenceType.Have,DontHave:H.BlockPresenceType.DontHave};u();var hr=1e3,Cs=3,As=10*hr,Yh=15*hr,ef=15*hr,Ts=Math.pow(2,31)-1,Fs=1e3,Ms=1;u();var Is=T(Os());var fr=class{constructor(e,t,n){this.peerId=t,this.network=n,this.refcnt=1,this._entries=[],this._log=K(e,"msgqueue"),this.sendEntries=(0,Is.default)(this._sendEntries.bind(this),Ms)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;let e=new k(!1);this._entries.forEach(t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)}),this._entries=[],this.addMessage(e)}async send(e){try{await this.network.connectTo(this.peerId)}catch(t){this._log.error("cant connect to peer %s: %s",this.peerId.toB58String(),t.message);return}this._log("sending message to peer %s",this.peerId.toB58String()),this.network.sendMessage(this.peerId,e).catch(t=>{this._log.error("send error: %s",t.message)})}};var Ps=T(it()),pr=class{constructor(e,t,n,i){this.peers=(0,Ps.default)({system:"ipfs",component:"bitswap",metric:"want-manager-peers",metrics:i.metrics}),this.wantlist=new le(n,i),this.network=t,this._stats=n,this._peerId=e,this._log=K(e,"want")}_addEntries(e,t,n){let i=e.map((s,o)=>new k.Entry(s,Ts-o,k.WantType.Block,t));i.forEach(s=>{s.cancel?n?this.wantlist.removeForce(s.cid.toString(B)):this.wantlist.remove(s.cid):(this._log("adding to wl"),this.wantlist.add(s.cid,s.priority))});for(let s of this.peers.values())s.addEntries(i)}_startPeerHandler(e){let t=this.peers.get(e.toB58String());if(t){t.refcnt++;return}t=new fr(this._peerId,e,this.network);let n=new k(!0);for(let i of this.wantlist.entries())n.addEntry(i[1].cid,i[1].priority);return t.addMessage(n),this.peers.set(e.toB58String(),t),t}_stopPeerHandler(e){let t=this.peers.get(e.toB58String());!t||(t.refcnt--,!(t.refcnt>0)&&this.peers.delete(e.toB58String()))}wantBlocks(e,t={}){this._addEntries(e,!1),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.cancelWants(e)})}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach(e=>this.disconnected(e.peerId))}};u();var xr=T(oo()),Br=T(uo()),Bo=T(xo());var vr="/ipfs/bitswap/1.0.0",Er="/ipfs/bitswap/1.1.0",kr="/ipfs/bitswap/1.2.0",Sr=class{constructor(e,t,n,i={}){this._log=K(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[vr],i.b100Only||(this._protocols.unshift(Er),this._protocols.unshift(kr)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=i.hashLoader}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection);let e=new Bo.default({multicodecs:this._protocols,handlers:{onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect}});this._registrarId=await this._libp2p.registrar.register(e);for await(let t of this._libp2p.peerStore.getPeers()){let n=this._libp2p.connectionManager.get(t.id);n&&this._onPeerConnect(n.remotePeer)}}async stop(){this._running=!1,await this._libp2p.unhandle(this._protocols),this._registrarId!=null&&this._libp2p.registrar.unregister(this._registrarId)}async _onConnection({protocol:e,stream:t,connection:n}){if(!!this._running){this._log("incoming new bitswap %s connection from %s",e,n.remotePeer.toB58String());try{await(0,Br.pipe)(t,xr.default.decode(),async i=>{for await(let s of i)try{let o=await k.deserialize(s.slice(),this._hashLoader);await this._bitswap._receiveMessage(n.remotePeer,o)}catch(o){this._bitswap._receiveError(o);break}})}catch(i){this._log(i)}}}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t,n={}){return this._libp2p.contentRouting.findProviders(e,{timeout:As,maxNumProviders:t})}async findAndConnect(e,t){let n=[];for await(let i of this.findProviders(e,Cs,t))this._log(`connecting to provider ${i.id}`),n.push(this.connectTo(i.id,t).catch(s=>{this._log.error(s)}));await Promise.all(n)}async provide(e,t){await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t){if(!this._running)throw new Error("network isn't running");let n=e.toB58String();this._log("sendMessage to %s",n,t);let i=await this._libp2p.dial(e),{stream:s,protocol:o}=await i.newStream([kr,Er,vr]),a;switch(o){case vr:a=t.serializeToBitswap100();break;case Er:case kr:a=t.serializeToBitswap110();break;default:throw new Error("Unknown protocol: "+o)}Hu(s,a,this._log),this._updateSentStats(e,t.blocks)}async connectTo(e,t){if(!this._running)throw new Error("network isn't running");return this._libp2p.dial(e,t)}_updateSentStats(e,t){let n=e.toB58String();if(this._stats){for(let i of t.values())this._stats.push(n,"dataSent",i.length);this._stats.push(n,"blocksSent",t.size)}}};async function Hu(r,e,t){try{await(0,Br.pipe)([e],xr.default.encode(),r)}catch(n){t(n)}}u();u();var Cr=class{constructor(e){this.partner=e,this.wantlist=new le,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=new Date().getTime(),this.accounting.bytesRecv+=e}wants(e,t,n){this.wantlist.add(e,t,n)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}};u();u();var kt=class extends Map{constructor(e,t){super();this._cmp=t||this._defaultSort,this._keys=[];for(let[n,i]of e||[])this.set(n,i)}update(e){if(e<0||e>=this._keys.length)return;let t=this._keys[e];this._keys.splice(e,1);let n=this._find(t);this._keys.splice(n,0,t)}set(e,t){if(this.has(e)){let i=this.indexOf(e);this._keys.splice(i,1)}super.set(e,t);let n=this._find(e);return this._keys.splice(n,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;let t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;let t=this._find(e);if(this._keys[t]===e)return t;for(let n=1;n<this._keys.length;n++){if(this._keys[t+n]===e)return t+n;if(this._keys[t-n]===e)return t-n}return-1}_find(e){let t=0,n=this._keys.length;for(;t<n;){let i=t+n>>>1,s=this._kCmp(this._keys[i],e);if(s<0)t=i+1;else if(s>0)n=i;else return i}return t}*keys(){for(let e of this._keys)yield e}*values(){for(let e of this._keys)yield this.get(e)}*entries(){for(let e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t){if(!!e)for(let n of this._keys)e.apply(t,[[n,this.get(n)]])}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}};var $u={hasNewInfo(){return!1},merge(){}},Ar=class{constructor(e=$u){this._taskMerger=e,this._byPeer=new kt([],Tr.compare)}pushTasks(e,t){let n=this._byPeer.get(e.toB58String());n||(n=new Tr(e,this._taskMerger)),n.pushTasks(t),this._byPeer.set(e.toB58String(),n)}popTasks(e){let t=this._head();if(t===void 0)return{tasks:[],pendingSize:0};let{tasks:n,pendingSize:i}=t.popTasks(e);if(n.length===0)return{tasks:n,pendingSize:i};let s=t.peerId;return t.isIdle()?this._byPeer.delete(s.toB58String()):this._byPeer.update(0),{peerId:s,tasks:n,pendingSize:i}}_head(){if(this._byPeer.size!==0)for(let[,e]of this._byPeer)return e}remove(e,t){let n=this._byPeer.get(t.toB58String());n&&n.remove(e)}tasksDone(e,t){let n=this._byPeer.get(e.toB58String());if(!n)return;let i=this._byPeer.indexOf(e.toB58String());for(let s of t)n.taskDone(s);this._byPeer.update(i)}},Tr=class{constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new vo,this._active=new Set}pushTasks(e){for(let t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;let t=this._pending.get(e.topic);if(t){e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),this._taskMerger.merge(e,t);return}this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){let t=[];for(let n of this._active)n.topic===e.topic&&t.push(n);return t.length===0?!0:this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0,n=[],i=this._pending.tasks();for(let s=0;s<i.length&&t<e;s++){let o=i[s];n.push(o),t+=o.size,this._pending.delete(o.topic),this._activeTotalSize+=o.size,this._active.add(o)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return this._pending.length===0&&this._active.size===0}static compare(e,t){return e[1]._pending.length===0?1:t[1]._pending.length===0?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}},vo=class{constructor(){this._tasks=new kt([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce((e,t)=>e+t.task.size,0)}get(e){return(this._tasks.get(e)||{}).task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map(e=>e.task)}updatePriority(e,t){let n=this._tasks.get(e);if(!n)return;let i=this._tasks.indexOf(e);n.task.priority=t,this._tasks.update(i)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}};u();var Eo={hasNewInfo(r,e){let t=!1,n=!1;for(let i of e)i.data.haveBlock&&(t=!0),i.data.isWantBlock&&(n=!0);return!!(!n&&r.data.isWantBlock||!t&&r.data.haveBlock)},merge(r,e){let t=r.data,n=e.data;!n.haveBlock&&t.haveBlock&&(n.haveBlock=t.haveBlock,n.blockSize=t.blockSize),!n.isWantBlock&&t.isWantBlock&&(n.isWantBlock=!0,(!n.haveBlock||t.haveBlock)&&(n.haveBlock=t.haveBlock,e.size=r.size)),n.isWantBlock&&n.haveBlock&&(e.size=n.blockSize)}};var ko=T(it()),So=k.WantType,Gu=16*1024,Vu=1024,Fr=class{constructor(e,t,n,i,s,o={}){this._log=K(e,"engine"),this.blockstore=t,this.network=n,this._stats=i,this._opts=this._processOpts(o),this.ledgerMap=(0,ko.default)({system:"ipfs",component:"bitswap",metric:"ledger-map",metrics:s.metrics}),this._running=!1,this._requestQueue=new Ar(Eo)}_processOpts(e){return{maxSizeReplaceHasWithBlock:Vu,targetMessageSize:Gu,...e}}_scheduleProcessTasks(){setTimeout(()=>{this._processTasks()})}async _processTasks(){if(!this._running)return;let{peerId:e,tasks:t,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(t.length===0)return;let i=new k(!1);i.setPendingBytes(n);let s=[],o=new Map;for(let c of t){let l=E.parse(c.topic);c.data.haveBlock?c.data.isWantBlock?(s.push(l),o.set(c.topic,c.data)):i.addHave(l):i.addDontHave(l)}let a=await this._getBlocks(s);for(let[c,l]of o){let h=E.parse(c),p=a.get(c);p?i.addBlock(h,p):l.sendDontHave&&i.addDontHave(h)}if(i.empty){e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks();return}try{e&&await this.network.sendMessage(e,i);for(let[c,l]of a.entries())e&&this.messageSent(e,E.parse(c),l)}catch(c){this._log.error(c)}e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){let t=e.toB58String(),n=this.ledgerMap.get(t);return n?n.wantlist.sortedEntries():new Map}ledgerForPeer(e){let t=e.toB58String(),n=this.ledgerMap.get(t);return n?{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map(e=>e.partner)}receivedBlocks(e){if(!!e.length){for(let t of this.ledgerMap.values())for(let n of e){let i=t.wantlistContains(n.cid);if(!i)continue;let s=n.data.length,o=this._sendAsBlock(i.wantType,s),a=s;o||(a=k.blockPresenceSize(i.cid)),this._requestQueue.pushTasks(t.partner,[{topic:i.cid.toString(B),priority:i.priority,size:a,data:{blockSize:s,isWantBlock:o,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){let n=this._findOrCreate(e);if(t.empty)return;if(t.full&&(n.wantlist=new le),this._updateBlockAccounting(t.blocks,n),t.wantlist.size===0){this._scheduleProcessTasks();return}let i=[],s=[];t.wantlist.forEach(o=>{o.cancel?(n.cancelWant(o.cid),i.push(o.cid)):(n.wants(o.cid,o.priority,o.wantType),s.push(o))}),this._cancelWants(e,i),await this._addWants(e,s),this._scheduleProcessTasks()}_cancelWants(e,t){for(let n of t)this._requestQueue.remove(n.toString(B),e)}async _addWants(e,t){let n=await this._getBlockSizes(t.map(s=>s.cid)),i=[];for(let s of t){let o=s.cid.toString(B),a=n.get(o);if(a==null)s.sendDontHave&&i.push({topic:o,priority:s.priority,size:k.blockPresenceSize(s.cid),data:{isWantBlock:s.wantType===So.Block,blockSize:0,haveBlock:!1,sendDontHave:s.sendDontHave}});else{let c=this._sendAsBlock(s.wantType,a),l=a;c||(l=k.blockPresenceSize(s.cid)),i.push({topic:o,priority:s.priority,size:l,data:{isWantBlock:c,blockSize:a,haveBlock:!0,sendDontHave:s.sendDontHave}})}this._requestQueue.pushTasks(e,i)}}_sendAsBlock(e,t){return e===So.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){let t=await this._getBlocks(e);return new Map([...t].map(([n,i])=>[n,i.length]))}async _getBlocks(e){let t=new Map;return await Promise.all(e.map(async n=>{try{let i=await this.blockstore.get(n);t.set(n.toString(B),i)}catch(i){i.code!=="ERR_NOT_FOUND"&&this._log.error("failed to query blockstore for %s: %s",n,i)}})),t}_updateBlockAccounting(e,t){for(let n of e.values())this._log("got block (%s bytes)",n.length),t.receivedBytes(n.length)}messageSent(e,t,n){let i=this._findOrCreate(e);i.sentBytes(n.length),i.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){this.ledgerMap.delete(e.toB58String())}_findOrCreate(e){let t=e.toB58String(),n=this.ledgerMap.get(t);if(n)return n;let i=new Cr(e);return this.ledgerMap.set(t,i),this._stats&&this._stats.push(t,"peerCount",1),i}start(){this._running=!0}stop(){this._running=!1}};u();var zo=T(At());u();u();u();var Lr={};J(Lr,{identity:()=>el});u();var el=lt({prefix:"\0",name:"identity",encode:r=>Fn(r),decode:r=>Tn(r)});var Or={};J(Or,{base2:()=>tl});u();var tl=F({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ir={};J(Ir,{base8:()=>rl});u();var rl=F({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Pr={};J(Pr,{base10:()=>nl});u();var nl=me({prefix:"9",name:"base10",alphabet:"0123456789"});var jr={};J(jr,{base16:()=>il,base16upper:()=>sl});u();var il=F({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),sl=F({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Dr={};J(Dr,{base36:()=>ol,base36upper:()=>al});u();var ol=me({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),al=me({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Nr={};J(Nr,{base64:()=>cl,base64pad:()=>ul,base64url:()=>ll,base64urlpad:()=>hl});u();var cl=F({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),ul=F({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),ll=F({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),hl=F({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Rr={};J(Rr,{identity:()=>dl});u();var Do=0,fl="identity",pl=r=>ke(Do,de(r)),dl={code:Do,name:fl,digest:pl};u();u();var np=new TextEncoder,ip=new TextDecoder;u();var Ur={...Lr,...Or,...Ir,...Pr,...jr,...Ht,...Dr,...Wt,...Nr},cp={...Gt,...Rr};function No(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}var Ro=No("utf8","u",r=>{let e=new TextDecoder("utf8");return"u"+e.decode(r)},r=>new TextEncoder().encode(r.substring(1))),zr=No("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),ml={utf8:Ro,"utf-8":Ro,hex:Ur.base16,latin1:zr,ascii:zr,binary:zr,...Ur},Uo=ml;function qr(r,e="utf8"){let t=Uo[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}var qo=r=>`unwant:${qr(r.multihash.bytes,"base64")}`,Wo=r=>`block:${qr(r.multihash.bytes,"base64")}`,Wr=class extends zo.EventEmitter{constructor(e){super();this.setMaxListeners(Fs),this._log=K(e,"notif")}hasBlock(e,t){let n=Wo(e);this._log(n),this.emit(n,t)}wantBlock(e,t={}){if(!e)throw new Error("Not a valid cid");let n=Wo(e),i=qo(e);return this._log(`wantBlock:${e}`),new Promise((s,o)=>{let a=()=>{this.removeListener(n,c),o(new Error(`Block for ${e} unwanted`))},c=l=>{this.removeListener(i,a),s(l)};this.once(i,a),this.once(n,c),t&&t.signal&&t.signal.addEventListener("abort",()=>{this.removeListener(n,c),this.removeListener(i,a),o(new Error(`Want for ${e} aborted`))})})}unwantBlock(e){let t=qo(e);this._log(t),this.emit(t)}};u();var Jo=T(At());u();var Vo=T(At()),Hr=T(Go()),Tt=class extends Vo.EventEmitter{constructor(e,t){super();this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach(n=>{this._stats[n]=BigInt(0),this._movingAverages[n]={},this._options.movingAverageIntervals.forEach(i=>{(this._movingAverages[n][i]=(0,Hr.default)(i)).push(this._frequencyLastTime,0)})}),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){let e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;for(;this._queue.length;){let t=e=this._queue.shift();t&&this._applyOp(t)}e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){let t=e-this._frequencyLastTime;t&&Object.keys(this._stats).forEach(n=>{this._updateFrequencyFor(n,t,e)}),this._frequencyLastTime=e}_updateFrequencyFor(e,t,n){let i=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;let s=i/t*1e3,o=this._movingAverages[e];o||(o=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach(a=>{let c=o[a];c||(c=o[a]=(0,Hr.default)(a)),c.push(n,s)})}_applyOp(e){let t=e[0],n=e[1];if(typeof n!="number")throw new Error(`invalid increment number: ${n}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(n),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=n}};var Qo=T(it()),Xo={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[60*1e3,5*60*1e3,15*60*1e3]},$r=class extends Jo.EventEmitter{constructor(e,t=[],n=Xo){super();let i=Object.assign({},Xo,n);if(typeof i.computeThrottleTimeout!="number")throw new Error("need computeThrottleTimeout");if(typeof i.computeThrottleMaxQueueSize!="number")throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=t,this._options=i,this._enabled=this._options.enabled,this._global=new Tt(t,i),this._global.on("update",s=>this.emit("update",s)),this._peers=(0,Qo.default)({system:"ipfs",component:"bitswap",metric:"stats-peers",metrics:e.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(let e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){let t=typeof e!="string"&&e.toB58String?e.toB58String():`${e}`;return this._peers.get(t)}push(e,t,n){if(this._enabled&&(this._global.push(t,n),e)){let i=this._peers.get(e);i||(i=new Tt(this._initialCounters,this._options),this._peers.set(e,i)),i.push(t,n)}}disconnected(e){let t=e.toB58String(),n=this._peers.get(t);n&&(n.stop(),this._peers.delete(t))}};var ua=T(Zo());u();var Vr=T(ea()),Me=T(ra()),Jr=T(ia()),aa=T(oa()),ca=(r,e)=>async function*(){yield*(await(0,aa.default)(r)).sort(e)}(),Qr=class{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(let{key:n,value:i}of e)await this.put(n,i,t),yield{key:n,value:i}}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(let n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await(0,Vr.default)(this.putMany(e,n)),e=[],await(0,Vr.default)(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null&&(n=(0,Me.default)(n,i=>i.key.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>(0,Me.default)(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>ca(i,s),n)),e.offset!=null){let i=0;n=(0,Me.default)(n,()=>i++>=(e.offset||0))}return e.limit!=null&&(n=(0,Jr.default)(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null&&(n=(0,Me.default)(n,i=>i.toString().startsWith(e.prefix||""))),Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>(0,Me.default)(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>ca(i,s),n)),e.offset!=null){let i=0;n=(0,Me.default)(n,()=>i++>=e.offset)}return e.limit!=null&&(n=(0,Jr.default)(n,e.limit)),n}};var El={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},kl=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"],Xr=class extends Qr{constructor(e,t,n={}){super();this._libp2p=e,this._log=K(this.peerId),this._options=Object.assign({},El,n),this._stats=new $r(e,kl,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new Sr(e,this,this._stats,{hashLoader:n.hashLoader}),this.blockstore=t,this.engine=new Fr(this.peerId,t,this.network,this._stats,e),this.wm=new pr(this.peerId,this.network,this._stats,e),this.notifications=new Wr(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch(i){this._log("failed to receive message",t)}if(t.blocks.size===0)return;let n=[];for(let[i,s]of t.blocks.entries()){let o=E.parse(i);n.push({wasWanted:this.wm.wantlist.contains(o),cid:o,data:s})}this.wm.cancelWants(n.filter(({wasWanted:i})=>i).map(({cid:i})=>i)),await Promise.all(n.map(({cid:i,wasWanted:s,data:o})=>this._handleReceivedBlock(e,i,o,s)))}async _handleReceivedBlock(e,t,n,i){this._log("received block");let s=await this.blockstore.has(t);this._updateReceiveCounters(e.toB58String(),t,n,s),!!i&&await this.put(t,n)}_updateReceiveCounters(e,t,n,i){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",n.length),i&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",n.length))}_receiveError(e){this._log.error("ReceiveError: %s",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async get(e,t={}){let n=(l,h)=>(this.wm.wantBlocks([l],h),this.notifications.wantBlock(l,h)),i=!1,s=async(l,h)=>{try{return await this.blockstore.get(l,h)}catch(p){if(p.code!=="ERR_NOT_FOUND")throw p;return i||(i=!0,this.network.findAndConnect(l).catch(w=>this._log.error(w))),n(l,h)}},o=new AbortController,a=t.signal?(0,ua.anySignal)([t.signal,o.signal]):o.signal,c=await Promise.race([this.notifications.wantBlock(e,{signal:a}),s(e,{signal:a})]);return o.abort(),c}async*getMany(e,t={}){for await(let n of e)yield this.get(n,t)}unwant(e){let t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach(n=>this.notifications.unwantBlock(n))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,n){await this.blockstore.put(e,t),this._sendHaveBlockNotifications(e,t)}async*putMany(e,t){for await(let{key:n,value:i}of this.blockstore.putMany(e,t))this._sendHaveBlockNotifications(n,i),yield{key:n,value:i}}_sendHaveBlockNotifications(e,t){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,data:t}]),this.network.provide(e).catch(n=>{this._log.error("Failed to provide: %s",n.message)})}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this._stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}unwrap(){return this.blockstore}};var Sl=(r,e,t={})=>new Xr(r,e,t);return Cl;})();
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
return IpfsBitswap}));
