(function (root, factory) {(typeof module === 'object' && module.exports) ? module.exports = factory() : root.HlsjsIpfsLoader = factory()}(typeof self !== 'undefined' ? self : this, function () {
var HlsjsIpfsLoader=(()=>{var g=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var w=g((p,b)=>{"use strict";var c=class{constructor(t){this._abortFlag=[!1],this.ipfs=t.ipfs,this.hash=t.ipfsHash,t.debug===!1?this.debug=function(){}:t.debug===!0?this.debug=console.log:this.debug=t.debug,t.m3u8provider?this.m3u8provider=t.m3u8provider:this.m3u8provider=null,t.tsListProvider?this.tsListProvider=t.tsListProvider:this.tsListProvider=null}destroy(){}abort(){this._abortFlag[0]=!0}load(t,e,i){this.context=t,this.config=e,this.callbacks=i,this.stats={trequest:performance.now(),retry:0},this.retryDelay=e.retryDelay,this.loadInternal()}setM3U8Provider(t){this.m3u8provider=t}setTsListProvider(t){this.tsListProvider=t}loadInternal(){let{stats:t,context:e,callbacks:i}=this;t.tfirst=Math.max(performance.now(),t.trequest),t.loaded=0;let a=window.location.href.split("/");a[a.length-1]!==""&&(a[a.length-1]="");let o=e.url.replace(a.join("/"),""),l={};if(Number.isFinite(e.rangeStart)&&(l.offset=e.rangeStart,Number.isFinite(e.rangeEnd)&&(l.length=e.rangeEnd-e.rangeStart)),o.split(".")[1]==="m3u8"&&this.m3u8provider!==null){let s=this.m3u8provider(),r;Buffer.isBuffer(s)?r=d(s):r=s;let f={url:e.url,data:r};i.onSuccess(f,t,e);return}if(o.split(".")[1]==="m3u8"&&this.tsListProvider!==null){var h=this.tsListProvider(),u=h[o];u&&this.cat(u).then(s=>{let r;Buffer.isBuffer(s)?r=d(s):r=s,t.loaded=t.total=r.length,t.tload=Math.max(t.tfirst,performance.now());let f={url:e.url,data:r};i.onSuccess(f,t,e)});return}this._abortFlag[0]=!1,v(this.ipfs,this.hash,o,l,this.debug,this._abortFlag).then(s=>{let r=e.responseType==="arraybuffer"?s:d(s);t.loaded=t.total=r.length,t.tload=Math.max(t.tfirst,performance.now());let f={url:e.url,data:r};i.onSuccess(f,t,e)},console.error)}};async function v(n,t,e,i,a,o){a(`Fetching hash for '${t}/${e}'`);let l=`${t}/${e}`;try{return await m(l,i,n,a,o)}catch(h){throw new Error(`File not found: ${t}/${e}`)}}function d(n){return new TextDecoder().decode(n)}async function m(n,t,e,i,a){let o=[],l=0,h=0;for await(let s of e.cat(n,t))if(o.push(s),l+=s.length,a[0]){i("Cancel reading from ipfs");break}let u=new Uint8Array(l);for(let s of o)u.set(s,h),h+=s.length;return i(`Received data for file '${n}' size: ${u.length} in ${o.length} blocks`),u}p=b.exports=c});return w();})();
return HlsjsIpfsLoader}));
